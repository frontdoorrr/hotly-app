# PRD: 지도 기반 시각화 및 경로 표시

## 1. 기능 개요
**핵심 가치:** 저장된 장소와 생성된 데이트 코스를 직관적인 지도 인터페이스로 시각화하여 공간적 관계를 명확히 파악하고, 실시간 경로 안내와 주변 정보까지 통합 제공한다.

**사용자 이점:** 텍스트 정보만으로는 파악하기 어려운 거리감과 동선을 지도로 한눈에 확인하여 데이트 코스의 실현 가능성을 사전 검토할 수 있다.

---

## 2. 페르소나(Persona)
**주 사용자:** 지영(25세, 대학원생)
- **맥락:** 처음 가는 지역에서 데이트할 때 장소 간 거리감을 모르겠고, 대중교통/도보 경로도 미리 확인하고 싶음
- **목표:** 지도에서 장소들의 위치와 이동 경로를 시각적으로 확인하여 실제 데이트 시 길 찾기 스트레스 최소화
- **동기:** 데이트 당일 헤매지 않고 계획한 대로 즐기고 싶음
- **제약:** 복잡한 지도 조작은 어려워하고, 느린 로딩에 민감함
- **성공 정의:** 3초 내 지도 로딩, 한눈에 전체 코스 파악 가능, 경로 안내로 실제 내비게이션 대체

**핵심 Pain Points:**
1. **거리감 부족:** 텍스트로만 보면 실제 이동시간/거리를 가늠하기 어려움
2. **경로 불명확:** 어떤 길로 가야 하는지, 대중교통 환승은 어떻게 하는지 모름
3. **주변 정보 부족:** 목적지 주변의 주차장, 지하철역 등 부가 정보 부재

---

## 3. 유저 스토리(User Stories)
- **공간 파악자**로서, 저장된 장소들을 지도에서 마커로 보고 싶다. 그래서 지역별 분포와 거리감을 직관적으로 파악한다.
- **경로 확인자**로서, 생성된 코스의 이동 경로를 지도에서 선으로 보고 싶다. 그래서 실제 동선을 사전 검토한다.
- **실시간 안내 사용자**로서, 현재 위치에서 다음 장소까지의 경로를 실시간으로 보고 싶다. 그래서 별도 내비게이션 없이 코스를 따라간다.
- **정보 수집자**로서, 각 장소 주변의 주차장/지하철역/편의시설을 지도에서 확인하고 싶다. 그래서 데이트 편의성을 높인다.

---

## 4. 유저 플로우(User Flow)

### 4-1. 지도 초기 로딩 플로우
1. **진입:** 장소 상세 또는 코스 화면에서 "지도 보기" 선택
2. **위치 권한:** GPS 위치 접근 권한 요청 (선택사항)
3. **지도 로딩:** 카카오맵 SDK 초기화 및 기본 뷰 설정
4. **마커 표시:** 해당 장소들을 마커로 지도에 배치
5. **화면 조정:** 모든 마커가 보이도록 자동 줌/이동

### 4-2. 코스 경로 시각화 플로우
1. **코스 선택:** 특정 코스의 지도 보기 실행
2. **순서별 마커:** 1, 2, 3 순서 번호가 표시된 마커 배치
3. **경로 표시:** 장소 간 이동 경로를 색상별 선으로 연결
4. **정보 패널:** 총 이동거리, 예상 소요시간 하단에 표시
5. **상호작용:** 마커 터치 시 장소 정보 팝업

### 4-3. 실시간 내비게이션 플로우
1. **내비 모드:** "길찾기 시작" 버튼으로 실시간 모드 전환
2. **현재 위치:** GPS로 실시간 위치 추적 및 표시
3. **경로 안내:** 다음 목적지까지 음성/진동 안내
4. **도착 감지:** 목적지 50m 반경 진입 시 "도착" 알림
5. **다음 단계:** 자동으로 다음 장소로 경로 업데이트

### 4-4. 에러/빈 상태 플로우
- **위치 권한 거부:** "수동 위치 입력" 또는 "서울 중심" 기본 표시
- **네트워크 오류:** 오프라인 지도 또는 "네트워크 연결 후 재시도" 안내
- **GPS 신호 약함:** "실내에서는 정확하지 않을 수 있습니다" 경고
- **장소 없음:** 빈 지도에 "저장된 장소가 없습니다" + 장소 추가 유도

---

## 5. 수용 기준(Acceptance Criteria)

| ID | 시나리오 | Given | When | Then |
|----|----------|-------|------|------|
| AC-01 | 지도 로딩 속도 | 장소 정보 존재 | 지도 화면 진입 시 | 3초 이내 마커와 함께 지도 표시 |
| AC-02 | 마커 정확성 | GPS 좌표 정보 있는 장소 | 마커 표시 시 | 실제 위치 오차 50m 이내 |
| AC-03 | 경로 시각화 | 2개 이상 장소가 있는 코스 | 코스 지도 보기 시 | 순서대로 연결된 경로 선 표시 |
| AC-04 | 실시간 위치 추적 | 위치 권한 허용됨 | 내비 모드 실행 시 | 1초마다 현재 위치 업데이트 |
| AC-05 | 자동 화면 조정 | 여러 장소 선택됨 | 지도 로딩 시 | 모든 마커가 화면에 들어오도록 줌 레벨 자동 설정 |
| AC-06 | 마커 상호작용 | 마커가 표시됨 | 마커 터치 시 | 장소명, 카테고리, 영업시간 팝업 표시 |
| AC-07 | 주변 시설 표시 | 지도 확대 시 | 줌 레벨 15 이상일 때 | 주차장, 지하철역, 편의점 아이콘 표시 |

---

## 6. 상충/의존성 점검(Conflict Matrix)

| 항목 | 잠재 충돌 | 정책/해결 |
|------|-----------|-----------|
| 마커 밀집도 vs 가독성 | 가까운 장소들의 마커 겹침 | 클러스터링으로 묶어서 표시, 확대 시 개별 분리 |
| 실시간 추적 vs 배터리 | GPS 지속 사용으로 배터리 소모 | 내비 모드만 실시간 추적, 일반 모드는 수동 새로고침 |
| 상세 정보 vs 화면 공간 | 팝업이 지도 영역 가림 | 하단 시트 방식으로 지도 위 1/3만 차지 |
| 오프라인 vs 실시간 정보 | 캐시된 지도 vs 최신 교통 정보 | 기본 지도는 캐시, 경로/교통 정보는 실시간 요청 |

---

## 7. 기능별 상세 명세

### 7-1. 마커 디자인
```
장소 마커:
├── 🍽️ 맛집: 빨간색 원형 (포크 아이콘)
├── ☕ 카페: 갈색 원형 (컵 아이콘)
├── 🎪 관광지: 파란색 원형 (카메라 아이콘)
├── 🛍️ 쇼핑: 초록색 원형 (쇼핑백 아이콘)
├── 🎨 문화시설: 보라색 원형 (건물 아이콘)
└── 🏃 액티비티: 주황색 원형 (별 아이콘)

코스 마커:
└── 순서 번호(1,2,3...) + 카테고리 색상 조합
```

### 7-2. 경로 시각화
```
경로 스타일:
- 선 두께: 4px
- 색상: 진행도별 그라데이션 (파랑→초록→노랑→빨강)
- 애니메이션: 경로를 따라 흐르는 점선 효과
- 이동수단별 선 스타일:
  * 도보: 점선 (- - -)
  * 대중교통: 실선 (──)
  * 자차: 굵은 실선 (━━)
```

### 7-3. 지도 레이어
```
Layer Priority (위에서부터):
1. 사용자 위치 (현재 위치 점)
2. 코스 경로 (이동 경로 선)
3. 장소 마커 (목적지들)
4. 주변 시설 (보조 정보)
5. 기본 지도 (카카오맵 타일)
```

### 7-4. 인터랙션 정의
```
제스처:
- 핀치: 줌 인/아웃
- 드래그: 지도 이동
- 더블 탭: 줌인 + 해당 위치 중심
- 길게 누르기: 해당 위치에 임시 마커 생성

버튼:
- 현재 위치: GPS 위치로 이동
- 전체 보기: 모든 마커 포함하도록 줌 조정
- 길찾기: 실시간 내비게이션 모드
- 레이어: 주변 시설 표시/숨김 토글
```

---

## 8. KPI / 측정 지표

### 8-1. 성능 지표
- **로딩 속도:** 지도 초기 로딩 p90 ≤ 3초
- **마커 정확도:** 실제 위치 대비 오차 평균 ≤ 30m
- **경로 정확성:** 실제 이동시간 vs 예상시간 오차 ≤ 15%

### 8-2. 사용성 지표
- **지도 이용률:** 코스 조회 중 지도 화면 진입 비율 ≥ 70%
- **내비 전환율:** 지도 보기 → 길찾기 모드 전환 비율 ≥ 25%
- **마커 상호작용:** 마커 터치 → 상세정보 확인 비율 ≥ 40%

### 8-3. 기술 지표
- **GPS 정확도:** 위치 추적 오차 반경 ≤ 10m (야외 기준)
- **배터리 효율:** 내비 모드 1시간 사용 시 배터리 소모 ≤ 15%
- **오프라인 대응:** 네트워크 끊김 시 기본 지도 표시 유지율 ≥ 80%

---

## 9. UI/UX 가이드라인

### 9-1. 지도 화면 레이아웃
```
┌─────────────────────────┐
│ [뒤로][필터][현재위치]      │ ← 상단 바
├─────────────────────────┤
│                         │
│        지도 영역         │ ← 메인 지도
│      (마커 + 경로)       │
│                         │
├─────────────────────────┤
│ 📍 현재 보고 있는 장소    │ ← 정보 패널
│ ⏱️ 총 3시간 30분 코스     │   (접기/펼치기)
└─────────────────────────┘
```

### 9-2. 마커 팝업 디자인
```
┌─────────────────┐
│ 🍽️ 장소명        │
│ 📍 주소 (1줄)     │
│ 🕐 영업: 09-21시  │
│ ⭐ 4.2 (127)     │
│ [상세보기][길찾기] │
└─────────────────┘
```

### 9-3. 내비게이션 UI
```
내비 모드 시 상단 고정:
┌─────────────────────────┐
│ 🎯 다음 목적지: 카페 ABC  │
│ 📍 200m 직진 후 우회전    │
│ ⏱️ 도착까지 3분           │
│ [일시정지][종료]          │
└─────────────────────────┘
```

---

## 10. 접근성 / 국제화

### 10-1. 접근성
- **시각 장애:** 마커/경로를 음성으로 설명, 진동으로 방향 안내
- **색맹 대응:** 마커를 색상 + 아이콘 조합으로 구분
- **운동 장애:** 음성 명령으로 지도 조작 (확대/축소/이동)
- **저시력:** 고대비 모드, 마커 크기 확대 옵션

### 10-2. 국제화
- **지도 언어:** 한국어/영어 지명 토글
- **거리 단위:** km/mile 자동 전환
- **좌표계:** 지역별 좌표계 자동 적용
- **방향 표기:** 동서남북/시계방향 선택

---

## 11. 외부 의존성

### 11-1. 지도 서비스
- **주 사용:** 카카오맵 SDK (한국 내 상세 정보)
- **보조:** Google Maps SDK (해외 지역 대응)
- **오프라인:** OpenStreetMap 타일 (기본 지도)

### 11-2. 위치 서비스
- **GPS:** 디바이스 내장 위치 서비스
- **보조:** WiFi/셀룰러 기반 위치 (실내/GPS 약한 곳)
- **지오코딩:** 주소 ↔ 좌표 변환

### 11-3. 경로 계산
- **도보:** 카카오맵 보행자 API
- **대중교통:** 서울/수도권 지하철/버스 API
- **자차:** 카카오내비 길찾기 API

---

## 12. 성능 최적화

### 12-1. 지도 렌더링
- **타일 캐싱:** 자주 보는 지역 타일 로컬 저장 (50MB)
- **마커 클러스터링:** 10개 이상 마커 시 거리별 그룹화
- **지연 로딩:** 화면에 보이는 영역만 상세 정보 로드
- **레벨별 표시:** 줌 레벨에 따라 마커 밀도 조절

### 12-2. 실시간 처리
- **위치 업데이트:** 이동량 기반 적응형 주기 (정지 시 10초, 이동 시 1초)
- **경로 재계산:** 경로 이탈 100m 시에만 재계산 실행
- **네트워크 최적화:** 배치 요청으로 API 호출 횟수 최소화

---

## 13. 용어 사전(Glossary)
- **마커:** 지도에 표시되는 장소 위치 표시점
- **클러스터링:** 가까운 여러 마커를 하나로 묶어 표시
- **지오코딩:** 주소를 GPS 좌표로 변환하는 과정
- **타일:** 지도를 구성하는 격자 모양의 이미지 조각
- **레이어:** 지도 위에 겹쳐서 표시되는 정보 층

---

## 14. 기술 제약
- **지도 SDK:** 카카오맵 JavaScript API v2
- **위치 정확도:** GPS 기준 5-10m 오차 (야외)
- **동시 사용자:** 1000명 동시 실시간 추적 지원
- **데이터 사용량:** 내비 모드 1시간당 약 10MB

---

## Changelog
- 2025-01-XX: 초기 문서 작성 (작성자: Claude)
