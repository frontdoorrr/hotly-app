# PRD: Firebase Auth 기반 인증

## 1. 기능 개요
**핵심 가치:** Firebase Authentication을 활용하여 안전하고 편리한 회원가입/로그인 경험을 제공하며, 소셜 로그인과 게스트 모드를 통해 사용자 진입 장벽을 최소화한다.

**사용자 이점:** 복잡한 회원가입 절차 없이 기존 소셜 계정으로 3초 내 로그인하여 바로 앱의 핵심 기능을 사용할 수 있다.

---

## 2. 페르소나(Persona)
**주 사용자:** 윤서(22세, 대학생)
- **맥락:** 새로운 앱마다 회원가입하는 것이 번거롭고, 복잡한 비밀번호 설정과 이메일 인증이 귀찮음
- **목표:** 가장 빠르고 간편한 방법으로 앱에 가입해서 친구들과 데이트 계획 공유하고 싶음
- **동기:** 데이트 앱은 개인정보가 중요하니까 안전하면서도 편리한 로그인 방식 선호
- **제약:** 복잡한 절차나 개인정보 과다 요구 시 앱 삭제, 소셜 로그인 선호
- **성공 정의:** 3번의 터치로 로그인 완료, 개인정보 최소 입력, 안전한 데이터 보호

**핵심 Pain Points:**
1. **회원가입 피로감:** 매번 새로운 ID/PW 생성하고 이메일 인증하는 번거로움
2. **개인정보 우려:** 데이트 관련 앱에 민감한 개인정보 입력 부담
3. **접근성 장벽:** 로그인하지 않으면 아무것도 할 수 없어서 앱 체험 불가

---

## 3. 유저 스토리(User Stories)
- **간편 가입자**로서, 구글/애플 계정으로 원클릭 로그인하고 싶다. 그래서 복잡한 회원가입 절차를 생략한다.
- **체험 사용자**로서, 로그인 없이도 기본 기능을 체험하고 싶다. 그래서 앱의 가치를 먼저 확인한 후 가입을 결정한다.
- **보안 중시자**로서, 내 데이트 계획과 위시리스트가 안전하게 보호되길 원한다. 그래서 신뢰할 수 있는 인증 시스템을 사용한다.
- **연동 추구자**로서, 여러 기기에서 동일한 계정으로 데이터를 동기화하고 싶다. 그래서 어디서든 내 정보에 접근한다.

---

## 4. 유저 플로우(User Flow)

### 4-1. 소셜 로그인 플로우
1. **로그인 화면:** "구글로 계속하기", "애플로 계속하기" 버튼 표시
2. **소셜 인증:** 선택한 플랫폼의 OAuth 인증 팝업 실행
3. **권한 동의:** 기본 프로필 정보(이름, 이메일) 접근 권한 동의
4. **계정 생성/로그인:** 신규 사용자는 자동 계정 생성, 기존 사용자는 로그인
5. **프로필 설정:** 신규 사용자의 경우 닉네임 및 프로필 사진 설정 (선택사항)

### 4-2. 이메일 회원가입 플로우
1. **이메일 입력:** "이메일로 계속하기" 선택 후 이메일 주소 입력
2. **비밀번호 설정:** 8자 이상, 영문/숫자 조합 비밀번호 생성
3. **이메일 인증:** 인증 이메일 발송 및 링크 클릭 확인
4. **기본 정보:** 닉네임 입력 (필수), 프로필 사진 (선택)
5. **약관 동의:** 이용약관 및 개인정보처리방침 동의

### 4-3. 게스트 모드 플로우
1. **게스트 진입:** "로그인 없이 둘러보기" 선택
2. **제한 안내:** 사용 가능한 기능과 제한사항 간단 안내
3. **기능 체험:** 장소 저장, 코스 생성 등 기본 기능 체험 (로컬 저장)
4. **가입 유도:** 체험 중 주요 시점에서 "가입하고 저장하기" 제안
5. **데이터 이전:** 가입 시 게스트 모드 데이터를 계정으로 이전

### 4-4. 로그인 유지 및 보안 플로우
1. **자동 로그인:** 앱 재실행 시 로그인 상태 유지 (30일)
2. **토큰 갱신:** Firebase 토큰 만료 전 자동 갱신
3. **보안 검증:** 민감한 작업 시 재인증 요구 (계정 삭제, 비밀번호 변경 등)
4. **로그아웃:** 사용자 요청 또는 보안 이벤트 시 안전한 로그아웃
5. **다중 기기:** 여러 기기에서 동일 계정 동시 사용 지원

---

## 5. 수용 기준(Acceptance Criteria)

| ID | 시나리오 | Given | When | Then |
|----|----------|-------|------|------|
| AC-01 | 소셜 로그인 속도 | 구글/애플 계정 연동됨 | 소셜 로그인 버튼 클릭 | 5초 이내 인증 완료 및 앱 진입 |
| AC-02 | 게스트 모드 진입 | 신규 앱 설치 | "둘러보기" 선택 | 즉시 메인 화면 진입, 기능 제한 안내 |
| AC-03 | 자동 로그인 | 이전에 로그인한 계정 | 앱 재실행 시 | 별도 로그인 없이 바로 메인 화면 |
| AC-04 | 게스트 데이터 이전 | 게스트 모드에서 데이터 생성 | 회원가입 완료 시 | 게스트 데이터가 계정으로 자동 이전 |
| AC-05 | 이메일 인증 | 이메일로 회원가입 | 인증 이메일 발송 | 5분 이내 이메일 도착, 링크 클릭으로 인증 |
| AC-06 | 계정 복구 | 비밀번호 분실 | "비밀번호 찾기" 실행 | 재설정 이메일 발송, 새 비밀번호 설정 가능 |
| AC-07 | 보안 재인증 | 중요 설정 변경 요청 | 계정 삭제/비밀번호 변경 | 현재 비밀번호 또는 생체인증 재확인 |

---

## 6. 상충/의존성 점검(Conflict Matrix)

| 항목 | 잠재 충돌 | 정책/해결 |
|------|-----------|-----------|
| 편의성 vs 보안 | 자동 로그인 vs 계정 보안 | 30일 자동 로그인 + 민감 작업 시 재인증 |
| 게스트 vs 가입 | 무료 체험 vs 가입 유도 | 핵심 기능 체험 후 고도화 기능에서 가입 유도 |
| 소셜 vs 자체 계정 | 간편함 vs 종속성 | 소셜 우선 권장, 이메일은 대안으로 제공 |
| 개인정보 최소화 vs 개인화 | 정보 수집 vs 맞춤 서비스 | 필수 최소 정보만 수집, 부가 정보는 선택적 제공 |

---

## 7. 기능별 상세 명세

### 7-1. 지원 인증 방식
```
소셜 로그인 (우선 순위):
├── 🎯 구글 (Google Sign-In)
├── 🍎 애플 (Sign in with Apple) - iOS만
├── 💬 카카오 (Kakao Login)
└── 📧 이메일 (Firebase Auth)

부가 방식:
├── 📱 SMS 인증 (선택 사항)
├── 👤 게스트 모드 (임시 계정)
└── 🔐 생체 인증 (로그인 유지)
```

### 7-2. 사용자 정보 스키마
```json
{
  "uid": "string (Firebase UID)",
  "email": "string",
  "displayName": "string",
  "photoURL": "string?",
  "phoneNumber": "string?",
  "emailVerified": "boolean",
  "provider": "google|apple|kakao|email",
  "createdAt": "timestamp",
  "lastLoginAt": "timestamp",
  "isGuest": "boolean",
  "profile": {
    "nickname": "string",
    "bio": "string?",
    "region": "string?",
    "preferences": {
      "notifications": "boolean",
      "dataSync": "boolean",
      "analytics": "boolean"
    }
  }
}
```

### 7-3. 권한 및 제한사항
```
게스트 모드 제한:
✅ 허용: 장소 저장 (로컬), 코스 생성, 지도 보기
❌ 제한: 코스 공유, 알림, 클라우드 동기화, 커뮤니티

로그인 후 추가 기능:
✅ 클라우드 저장/동기화
✅ 코스 공유 및 협업
✅ 알림 및 리마인더
✅ 개인화 추천
✅ 사용 통계 및 히스토리
```

### 7-4. 보안 정책
```
비밀번호 정책:
- 최소 8자, 최대 128자
- 영문 + 숫자 조합 필수
- 특수문자 권장 (필수 아님)
- 연속 3자 이상 동일 문자 금지

세션 관리:
- 토큰 유효기간: 1시간 (자동 갱신)
- 리프레시 토큰: 30일
- 다중 기기: 최대 5대 동시 로그인
- 의심 활동 감지 시 자동 로그아웃
```

---

## 8. KPI / 측정 지표

### 8-1. 가입 및 로그인
- **가입 전환율:** 앱 설치 → 회원가입 완료 ≥ 40%
- **소셜 로그인 비율:** 전체 가입 중 소셜 로그인 ≥ 70%
- **게스트 전환율:** 게스트 → 회원가입 전환 ≥ 25%

### 8-2. 사용자 유지
- **로그인 성공률:** 로그인 시도 → 성공 ≥ 95%
- **자동 로그인률:** 앱 재실행 시 자동 로그인 성공 ≥ 90%
- **계정 유지율:** 가입 후 30일 활성 사용자 비율 ≥ 60%

### 8-3. 보안 및 신뢰
- **이메일 인증률:** 이메일 가입 시 인증 완료율 ≥ 80%
- **계정 복구 성공률:** 비밀번호 찾기 → 복구 완료 ≥ 85%
- **보안 사고:** 계정 해킹/도용 사고 0건

---

## 9. UI/UX 가이드라인

### 9-1. 로그인 화면
```
┌─────────────────────────┐
│                         │
│      🎯 Hotly           │
│   데이트 코스 플래너      │
│                         │
│ [🎯 구글로 계속하기]      │
│ [🍎 애플로 계속하기]      │
│ [💬 카카오로 계속하기]     │
│                         │
│ [이메일로 가입하기]       │
│                         │
│ 로그인 없이 둘러보기      │
└─────────────────────────┘
```

### 9-2. 이메일 가입 폼
```
┌─────────────────────────┐
│ ← 이메일로 가입          │
├─────────────────────────┤
│ 이메일 주소              │
│ [example@email.com  ]   │
│                         │
│ 비밀번호                │
│ [•••••••••••••••••• ] 👁 │
│ 8자 이상, 영문+숫자      │
│                         │
│ 닉네임                  │
│ [홍길동             ]   │
│                         │
│ ☑️ 이용약관 및 개인정보   │
│    처리방침에 동의합니다  │
│                         │
│ [가입하기]              │
└─────────────────────────┘
```

### 9-3. 게스트 모드 안내
```
┌─────────────────────────┐
│ 👋 게스트로 둘러보는 중  │
├─────────────────────────┤
│ 현재 사용 가능:          │
│ ✅ 장소 저장 (기기 내)    │
│ ✅ 코스 만들기           │
│ ✅ 지도 보기            │
│                         │
│ 가입하면 추가로:         │
│ 🚀 클라우드 동기화       │
│ 🚀 친구와 코스 공유      │
│ 🚀 맞춤 추천            │
│                         │
│ [지금 가입하기]         │
│ [나중에 하기]           │
└─────────────────────────┘
```

---

## 10. 접근성 / 국제화

### 10-1. 접근성
- **스크린리더:** 로그인 방식별 설명 음성 제공
- **키보드 탐색:** Tab 키로 모든 로그인 옵션 접근 가능
- **고대비:** 로그인 버튼과 배경 명확한 대비
- **터치:** 로그인 버튼 최소 48px 높이

### 10-2. 국제화
- **다국어:** 한국어/영어 로그인 화면
- **소셜 계정:** 지역별 인기 소셜 플랫폼 지원
- **약관:** 서비스 지역별 법적 요구사항 반영
- **에러 메시지:** 현지화된 오류 안내

---

## 11. Firebase 연동 상세

### 11-1. Firebase 프로젝트 설정
```
Authentication 제공업체:
├── 이메일/비밀번호 ✅
├── Google ✅
├── Apple ✅ (iOS)
├── 카카오 (Custom Auth)
└── 익명 인증 ✅ (게스트)

Security Rules:
- 사용자는 자신의 데이터만 접근
- 게스트는 읽기 전용
- 관리자 역할 분리
```

### 11-2. 토큰 관리
```javascript
// Firebase 토큰 갱신
firebase.auth().onIdTokenChanged((user) => {
  if (user) {
    user.getIdToken().then(token => {
      // API 요청 시 헤더에 포함
      headers: { Authorization: `Bearer ${token}` }
    });
  }
});
```

### 11-3. 오프라인 지원
- **토큰 캐시:** 로컬에 암호화 저장
- **오프라인 인증:** 캐시된 토큰으로 임시 인증
- **자동 동기화:** 온라인 복귀 시 토큰 검증 및 갱신

---

## 12. 보안 강화

### 12-1. 추가 보안 기능
```
생체 인증 (선택):
├── 지문 인식 (Android/iOS)
├── 얼굴 인식 (Face ID)
├── 패턴 (Android)
└── PIN (4-6자리)

이상 탐지:
├── 새로운 기기 로그인 알림
├── 지역 기반 의심 접근 감지
├── 반복 로그인 실패 차단 (5회)
└── 무차별 대입 공격 방어
```

### 12-2. 데이터 보호
- **전송 암호화:** HTTPS/TLS 1.3
- **저장 암호화:** AES-256 (민감 정보)
- **개인정보 마스킹:** 로그에서 이메일/전화번호 마스킹
- **GDPR 준수:** EU 사용자 데이터 보호 규정 준수

---

## 13. 에러 처리

### 13-1. 일반적인 에러 상황
```
로그인 실패:
├── 잘못된 이메일/비밀번호
├── 계정 미존재
├── 계정 비활성화/정지
├── 네트워크 연결 오류
└── 서버 일시 장애

소셜 로그인 실패:
├── 소셜 계정 연결 취소
├── 권한 거부
├── 소셜 플랫폼 장애
└── 앱 설정 오류
```

### 13-2. 사용자 친화적 에러 메시지
```
"이메일 또는 비밀번호가 잘못되었어요"
→ [비밀번호 찾기] 버튼 제공

"네트워크 연결을 확인해주세요"
→ [다시 시도] 버튼 + 오프라인 모드 안내

"잠시 후 다시 시도해주세요"
→ 서버 오류 시 자동 재시도 + 예상 복구 시간
```

---

## 14. 용어 사전(Glossary)
- **Firebase Auth:** 구글이 제공하는 인증 서비스 플랫폼
- **OAuth:** 소셜 로그인에 사용되는 개방형 인증 표준
- **JWT:** JSON 형태의 토큰으로 사용자 인증 정보를 안전하게 전달
- **게스트 모드:** 계정 생성 없이 제한된 기능을 체험할 수 있는 임시 계정
- **생체 인증:** 지문, 얼굴 등 생체 정보를 이용한 보안 인증

---

## 15. 기술 제약
- **Firebase 제한:** 월 10,000명 활성 사용자 (무료 플랜)
- **소셜 로그인:** 플랫폼별 API 제한 및 정책 변경 위험
- **토큰 관리:** JWT 토큰 크기 제한 (8KB)
- **오프라인:** 네트워크 없이는 신규 가입/로그인 불가

---

## Changelog
- 2025-01-XX: 초기 문서 작성 (작성자: Claude)
