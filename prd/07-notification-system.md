# PRD: 알림 및 리마인더 시스템

## 1. 기능 개요
**핵심 가치:** 사용자의 데이트 계획과 일정에 맞춰 적시에 유용한 정보를 제공하고, 방문 전 준비사항이나 실시간 변동사항을 놓치지 않도록 스마트한 알림을 전송한다.

**사용자 이점:** 데이트 당일 영업시간 확인, 예약, 교통편 준비 등을 잊지 않도록 도와주어 완벽한 데이트를 위한 사전 준비를 지원한다.

---

## 2. 페르소나(Persona)
**주 사용자:** 준호(28세, 직장인)
- **맥락:** 바쁜 업무로 인해 데이트 준비를 미루다가 당일 아침에 허둥지둥하는 경우가 많음
- **목표:** 사전에 필요한 정보와 할 일을 알림으로 받아서 여유롭고 완벽한 데이트 준비
- **동기:** 여자친구에게 신경 쓰는 모습을 보여주고 싶고, 데이트 실패를 방지하고 싶음
- **제약:** 업무 시간 중 너무 자주 울리는 알림은 부담, 불필요한 알림은 바로 차단
- **성공 정의:** 알림 덕분에 예약/준비를 완료하고 데이트를 성공적으로 마무리

**핵심 Pain Points:**
1. **준비 사항 망각:** 예약 필요 여부, 영업시간 변경, 휴무일 등을 놓쳐서 당황
2. **타이밍 부적절:** 너무 이른 알림(1주일 전) 또는 너무 늦은 알림(출발 직전)
3. **정보 부족:** 단순 "내일 데이트"만 알리고 구체적인 액션 가이드 부재

---

## 3. 유저 스토리(User Stories)
- **계획 준비자**로서, 데이트 전날에 내일의 일정과 준비사항을 알림으로 받고 싶다. 그래서 미리 준비하여 여유롭게 출발한다.
- **실시간 정보 수요자**로서, 방문 예정 장소의 영업시간 변경이나 임시 휴무 소식을 즉시 알고 싶다. 그래서 대안을 마련한다.
- **효율성 추구자**로서, 출발 시간과 교통 상황을 고려한 알림을 받고 싶다. 그래서 지각 없이 약속을 지킨다.
- **개인화 선호자**로서, 내 스케줄과 선호도에 맞는 맞춤형 알림 설정을 하고 싶다. 그래서 꼭 필요한 알림만 받는다.

---

## 4. 유저 플로우(User Flow)

### 4-1. 알림 설정 플로우
1. **기본 설정:** 온보딩 시 알림 허용 여부 및 기본 시간대 설정
2. **세부 설정:** 알림 유형별 ON/OFF (일정, 준비사항, 교통, 날씨 등)
3. **시간 설정:** 데이트 전날 몇 시에, 당일 출발 몇 분 전에 알림 받을지 설정
4. **조용 시간:** 업무/수면 시간대 설정하여 해당 시간에는 알림 차단
5. **테스트 알림:** 설정 완료 후 테스트 알림 발송으로 확인

### 4-2. 일정 기반 자동 알림 플로우
1. **일정 감지:** 코스에 방문 예정일/시간이 설정됨
2. **알림 스케줄링:** 설정된 규칙에 따라 알림 시점 계산
3. **컨텍스트 수집:** 날씨, 교통, 영업시간, 예약 필요성 등 관련 정보 조회
4. **알림 생성:** 개인화된 메시지와 액션 버튼 포함한 알림 생성
5. **발송 및 추적:** 알림 전송 후 열람/클릭 여부 추적

### 4-3. 실시간 변동 알림 플로우
1. **모니터링:** 저장된 장소들의 영업정보, 날씨, 교통 상황 주기적 확인
2. **변동 감지:** 기존 정보 대비 중요한 변화 발생 감지
3. **영향도 평가:** 사용자의 계획에 미치는 영향도 판단
4. **긴급 알림:** 중요한 변동사항은 조용시간 무시하고 즉시 발송
5. **대안 제시:** 문제 상황 시 대체 장소나 시간 조정 제안

### 4-4. 사용자 상호작용 플로우
1. **알림 수신:** 푸시 알림 또는 인앱 알림 표시
2. **액션 선택:** 알림의 CTA 버튼 클릭 (예약하기, 경로 확인, 연기하기 등)
3. **빠른 응답:** 알림에서 직접 간단한 액션 수행 (완료 체크, 스누즈 등)
4. **피드백:** 유용했거나 불필요한 알림에 대한 평가 (선택사항)
5. **학습 반영:** 사용자 반응을 바탕으로 향후 알림 개선

---

## 5. 수용 기준(Acceptance Criteria)

| ID | 시나리오 | Given | When | Then |
|----|----------|-------|------|------|
| AC-01 | 사전 준비 알림 | 데이트 일정이 등록됨 | 설정된 시간(예: 전날 18시) | 일정과 준비사항이 포함된 알림 발송 |
| AC-02 | 출발 시간 알림 | 코스 첫 장소와 출발지 설정 | 계산된 출발 시간 30분 전 | 교통 상황을 반영한 출발 알림 발송 |
| AC-03 | 영업시간 변동 알림 | 방문 예정 장소의 영업시간 변경 | 변경 감지 시점 | 1시간 내 변동 알림 및 대안 제시 |
| AC-04 | 조용시간 준수 | 조용시간(예: 22-08시) 설정됨 | 해당 시간대 일반 알림 | 긴급 알림 제외하고 다음 활성 시간까지 지연 발송 |
| AC-05 | 알림 개인화 | 사용자의 알림 설정과 과거 반응 | 알림 생성 시 | 개인 선호도를 반영한 맞춤형 메시지와 타이밍 |
| AC-06 | 중복 방지 | 동일한 내용의 알림 여러 건 | 24시간 내 유사 알림 발송 시도 | 중복 감지하여 최신 정보로 통합 발송 |
| AC-07 | 액션 연동 | 알림의 CTA 버튼 클릭 | 버튼 터치 시 | 해당 기능으로 딥링크 이동 및 컨텍스트 유지 |

---

## 6. 상충/의존성 점검(Conflict Matrix)

| 항목 | 잠재 충돌 | 정책/해결 |
|------|-----------|-----------|
| 유용성 vs 스팸 | 도움되는 알림 vs 과도한 빈도 | 주당 최대 7개 제한, 사용자 피드백 기반 조절 |
| 실시간 vs 배터리 | 즉시 알림 vs 배터리 소모 | 중요도별 체크 주기 차등 적용 (긴급: 1시간, 일반: 6시간) |
| 개인화 vs 복잡성 | 맞춤형 vs 설정 어려움 | 스마트 기본값 + 간단한 ON/OFF 토글 |
| 조용시간 vs 긴급성 | 방해 금지 vs 중요 알림 | 긴급도 3단계로 구분, 최고 단계만 조용시간 무시 |

---

## 7. 기능별 상세 명세

### 7-1. 알림 유형 분류
```
📅 일정 알림:
├── 데이트 전날 준비 (D-1, 18:00)
├── 당일 출발 시간 (계산된 시점 -30분)
└── 다음 장소 이동 (체류시간 -15분)

⚠️ 변동 알림:
├── 영업시간 변경/임시휴무 (감지 즉시)
├── 날씨 급변 (우천/폭설 등, 6시간 전)
└── 교통 대란 (지연 30분 이상 예상 시)

💡 추천 알림:
├── 새 장소 추천 (주 1회, 맞춤형)
├── 인기 코스 소개 (월 2회)
└── 계절 특화 콘텐츠 (월 1회)
```

### 7-2. 알림 우선순위
```
🔴 긴급 (즉시 발송):
- 방문 예정 장소 임시 휴무
- 교통 마비로 인한 심각한 지연
- 악천후 경보 (태풍, 폭우 등)

🟡 중요 (조용시간 외 발송):
- 영업시간 변경
- 출발 시간 안내
- 예약 필요 리마인드

🟢 일반 (설정 시간에 발송):
- 데이트 전날 준비 안내
- 새로운 장소 추천
- 주간/월간 요약
```

### 7-3. 알림 메시지 템플릿
```
사전 준비 알림:
"내일 오후 2시 홍대 데이트 준비 완료! 🎯
📍 카페 ABC: 대기 많음, 2시간 전 예약 권장
📍 맛집 DEF: 웨이팅 예상, 번호표 미리 받기
☔ 오후 비 예보, 우산 챙기세요!"

출발 시간 알림:
"30분 후 출발하세요! 🚇
📍 목적지까지 지하철 37분 (2호선 → 6호선)
🚇 현재 지연 없음, 예정대로 출발 OK
💡 카페 ABC 도착 예상: 오후 2:05"
```

### 7-4. 설정 데이터 스키마
```json
{
  "userId": "string",
  "notificationSettings": {
    "enabled": "boolean",
    "quietHours": {
      "start": "HH:mm",
      "end": "HH:mm",
      "daysOfWeek": "string[]"
    },
    "types": {
      "dateReminder": "boolean",
      "departureTime": "boolean", 
      "businessHours": "boolean",
      "weather": "boolean",
      "traffic": "boolean",
      "recommendations": "boolean"
    },
    "timing": {
      "dayBeforeHour": "number (18)",
      "departureMinutesBefore": "number (30)",
      "moveReminderMinutes": "number (15)"
    }
  },
  "deviceTokens": ["FCM_TOKEN_1", "FCM_TOKEN_2"]
}
```

---

## 8. KPI / 측정 지표

### 8-1. 전송 성능
- **전송 성공률:** 발송 시도 → 디바이스 도착 ≥ 95%
- **타이밍 정확도:** 예정 시간 ± 5분 내 발송 ≥ 90%
- **중복 방지율:** 24시간 내 동일 내용 중복 발송 ≤ 5%

### 8-2. 사용자 반응
- **열람률:** 알림 발송 → 열어봄 ≥ 60%
- **액션률:** 알림 → CTA 클릭 ≥ 25%
- **차단률:** 알림 설정 해제 비율 ≤ 10%

### 8-3. 가치 제공
- **만족도:** 알림이 도움되었다는 피드백 비율 ≥ 70%
- **데이트 성공률:** 알림 수신자의 계획된 데이트 완주율 ≥ 85%
- **재설정률:** 알림을 끈 사용자의 다시 켜는 비율 ≥ 30%

---

## 9. UI/UX 가이드라인

### 9-1. 푸시 알림 디자인
```
📱 Lock Screen:
┌─────────────────────────┐
│ 🎯 Hotly               │
│ 내일 홍대 데이트 준비!    │
│ 카페 예약 + 우산 필수    │
│ 지금 • 설정             │
└─────────────────────────┘

📱 Notification Panel:
┌─────────────────────────┐
│ 🎯 30분 후 출발         │
│ 지하철 2→6호선 (37분)    │
│ [경로보기] [연기하기]     │
│ 5분 전 • Hotly         │
└─────────────────────────┘
```

### 9-2. 인앱 알림 센터
```
┌─────────────────────────┐
│ 🔔 알림                 │
├─────────────────────────┤
│ 📅 오늘                 │
│ 🎯 출발 시간 (30분 후)   │
│ ⚠️ 카페 ABC 대기 많음    │
├─────────────────────────┤
│ 📅 어제                 │
│ ✅ 데이트 준비 완료      │
│ ☔ 날씨 변경 알림        │
└─────────────────────────┘
```

### 9-3. 설정 화면
```
🔔 알림 설정
├── 전체 알림 [ON/OFF 토글]
├── 📅 일정 알림
│   ├── 데이트 전날 알림 ✅ (18:00)
│   ├── 출발 시간 알림 ✅ (30분 전)
│   └── 이동 시간 알림 ✅ (15분 전)
├── ⚠️ 실시간 알림  
│   ├── 영업시간 변경 ✅
│   ├── 날씨 변동 ✅
│   └── 교통 지연 ✅
├── 🌙 조용한 시간 (22:00-08:00)
└── 💡 추천 알림 (주 1회)
```

---

## 10. 접근성 / 국제화

### 10-1. 접근성
- **시각 장애:** 알림 내용 전체를 TTS로 읽어주기
- **청각 장애:** 중요 알림은 진동 패턴으로 구분 표시
- **인지 장애:** 복잡한 정보를 단순 문장으로 요약
- **고대비:** 알림 아이콘과 배경 명확한 색상 대비

### 10-2. 국제화
- **시간 표기:** 12/24시간제 자동 선택
- **날씨 정보:** 섭씨/화씨 온도 단위
- **교통 안내:** 지역별 대중교통 용어 (지하철/전철/메트로)
- **톤 앤 매너:** 문화권별 적절한 존댓말/반말 수준

---

## 11. 외부 의존성

### 11-1. 푸시 알림 서비스
- **Firebase Cloud Messaging:** 안드로이드/iOS 푸시
- **Apple Push Notification Service:** iOS 네이티브 푸시
- **백업:** AWS SNS (FCM 장애 시 대체)

### 11-2. 실시간 정보 소스
- **날씨:** 기상청 API + OpenWeatherMap
- **교통:** 지하철/버스 실시간 API
- **영업시간:** 네이버 플레이스, 카카오맵 크롤링

### 11-3. 스케줄링 시스템
- **작업 큐:** Redis + Bull (알림 스케줄링)
- **크론 작업:** 주기적 정보 업데이트
- **실시간 모니터링:** WebSocket 또는 SSE

---

## 12. 개인정보 보호

### 12-1. 최소 수집 원칙
- **필수 정보:** 디바이스 토큰, 알림 설정만 저장
- **위치 정보:** 알림 생성 시점에만 임시 사용, 미저장
- **일정 정보:** 사용자 기기 내 암호화 저장

### 12-2. 투명성 확보
- **수집 고지:** 어떤 정보를 왜 사용하는지 명확 안내
- **제어권:** 언제든 알림 유형별 ON/OFF 가능
- **삭제권:** 계정 삭제 시 모든 알림 관련 데이터 삭제

---

## 13. 용어 사전(Glossary)
- **푸시 알림:** 앱이 닫혀있어도 받을 수 있는 시스템 알림
- **조용시간:** 일반 알림을 받지 않는 시간대 설정
- **딥링크:** 알림 클릭 시 앱의 특정 화면으로 바로 이동하는 기능
- **CTA:** Call To Action, 알림에서 사용자의 액션을 유도하는 버튼
- **스케줄링:** 미래의 특정 시점에 알림을 발송하도록 예약하는 것

---

## 14. 기술 제약
- **동시 발송:** 최대 10,000건/분 (FCM 제한)
- **메시지 길이:** 제목 50자, 내용 150자 (iOS 제한)
- **보관 기간:** 발송 기록 90일 (디버깅용)
- **실시간 정보:** 최대 15분 지연 허용 (외부 API 의존)

---

## Changelog
- 2025-01-XX: 초기 문서 작성 (작성자: Claude)