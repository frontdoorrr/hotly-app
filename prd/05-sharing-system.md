# PRD: 코스 공유 및 협업 기능

## 1. 기능 개요
**핵심 가치:** 생성된 데이트 코스를 연인이나 친구와 쉽게 공유하고, 공동 편집과 의견 교환을 통해 모두가 만족하는 최종 계획을 협력적으로 완성한다.

**사용자 이점:** 메신저로 장소 정보를 일일이 전달하는 번거로움 없이, 한 번의 링크 공유로 상대방이 전체 코스를 시각적으로 확인하고 함께 개선할 수 있다.

---

## 2. 페르소나(Persona)
**주 사용자:** 민수(26세, 회사원) & 혜진(24세, 카페 직원) 커플
- **맥락:** 민수가 주말 데이트 코스를 미리 계획하지만 혜진의 의견도 반영하고 싶음. 카톡으로 장소별 설명하기엔 복잡함
- **목표:** 계획한 코스를 혜진과 시각적으로 공유하고, 서로 의견을 나눠서 둘 다 만족하는 최종 코스 확정
- **동기:** 데이트 당일 "여기 별로네" 같은 상황을 사전에 방지하고 싶음
- **제약:** 복잡한 협업 도구는 부담스럽고, 실시간 채팅은 업무 중 어려움
- **성공 정의:** 링크 하나로 전체 코스 공유 완료, 상대방이 3분 내 이해하고 피드백 제공

**핵심 Pain Points:**
1. **정보 전달의 복잡성:** 여러 장소를 메신저로 설명하기 어렵고 오해 발생 가능
2. **시각적 이해 부족:** 텍스트만으로는 전체 코스의 흐름과 동선을 파악하기 어려움
3. **비동기 소통 한계:** 실시간 대화가 어려울 때 의견 조율이 지연됨

---

## 3. 유저 스토리(User Stories)
- **코스 기획자**로서, 완성된 코스를 링크 하나로 연인에게 공유하고 싶다. 그래서 복잡한 설명 없이 전체 계획을 전달한다.
- **협업자**로서, 공유받은 코스에 댓글로 의견을 남기고 싶다. 그래서 개별 장소에 대한 생각을 구체적으로 표현한다.
- **공동 편집자**로서, 공유된 코스의 일부 장소를 수정하거나 대안을 제안하고 싶다. 그래서 함께 더 나은 코스를 만든다.
- **열람자**로서, 공유받은 코스를 내 위시리스트에 복사하고 싶다. 그래서 좋은 아이디어를 내 계정에 보관한다.

---

## 4. 유저 플로우(User Flow)

### 4-1. 코스 공유 플로우
1. **공유 트리거:** 완성된 코스 화면에서 "공유하기" 버튼 선택
2. **공유 설정:** 읽기 전용 vs 편집 가능, 만료일 설정 (선택)
3. **링크 생성:** 고유 공유 링크 및 QR 코드 자동 생성
4. **공유 실행:** 카톡, 문자, 이메일 등으로 링크 전송
5. **알림:** 상대방이 링크를 열었을 때 공유자에게 알림

### 4-2. 공유 코스 열람 플로우
1. **링크 접근:** 공유 링크를 통해 Hotly 앱 또는 웹 진입
2. **코스 표시:** 지도와 타임라인으로 전체 코스 시각화
3. **상세 확인:** 각 장소별 정보, 이동시간, 예상 일정 검토
4. **상호작용:** 장소별 댓글 작성, 좋아요/싫어요 반응
5. **액션 선택:** 내 계정에 복사, 대안 제안, 편집 참여

### 4-3. 협업 편집 플로우
1. **편집 권한:** 공유자가 편집 가능으로 설정한 경우만 활성화
2. **실시간 편집:** 장소 추가/삭제/순서 변경 시 실시간 반영
3. **변경 히스토리:** 누가 언제 무엇을 바꿨는지 기록
4. **충돌 방지:** 동시 편집 시 "다른 사용자가 편집 중" 알림
5. **최종 승인:** 변경사항을 원래 코스에 반영할지 공유자가 결정

### 4-4. 에러/빈 상태 플로우
- **링크 만료/삭제:** "더 이상 접근할 수 없는 코스입니다" + 새 코스 추천
- **권한 없음:** "읽기 전용 코스입니다" + 복사해서 편집 옵션
- **네트워크 오류:** 오프라인 상태에서도 기본 정보 표시
- **로그인 필요:** 게스트도 열람 가능, 댓글/편집은 로그인 유도

---

## 5. 수용 기준(Acceptance Criteria)

| ID | 시나리오 | Given | When | Then |
|----|----------|-------|------|------|
| AC-01 | 공유 링크 생성 | 완성된 코스 존재 | 공유 버튼 클릭 | 3초 이내 고유 링크 생성 및 표시 |
| AC-02 | 링크 접근 속도 | 유효한 공유 링크 | 링크 클릭 시 | 5초 이내 코스 내용 로딩 완료 |
| AC-03 | 크로스 플랫폼 | 다양한 디바이스/브라우저 | 공유 링크 접근 | 모바일/데스크톱/웹브라우저 모두 정상 표시 |
| AC-04 | 댓글 실시간 반영 | 다른 사용자가 댓글 작성 | 새 댓글 등록 시 | 5초 이내 모든 열람자에게 실시간 표시 |
| AC-05 | 편집 권한 제어 | 편집 가능 설정된 코스 | 권한 있는 사용자 편집 시 | 변경사항 즉시 반영 및 히스토리 기록 |
| AC-06 | 코스 복사 기능 | 공유받은 코스 열람 중 | "내 계정에 복사" 실행 | 동일한 코스가 개인 계정에 저장됨 |
| AC-07 | 만료/삭제 처리 | 만료되거나 삭제된 링크 | 만료된 링크 접근 시 | 적절한 오류 메시지와 대안 제시 |

---

## 6. 상충/의존성 점검(Conflict Matrix)

| 항목 | 잠재 충돌 | 정책/해결 |
|------|-----------|-----------|
| 개방성 vs 프라이버시 | 누구나 볼 수 있는 링크 vs 개인정보 | 기본은 로그인 없이 열람, 민감정보는 마스킹 |
| 실시간 편집 vs 안정성 | 동시 편집 시 데이터 손실 위험 | 락 메커니즘 + 자동 저장으로 충돌 방지 |
| 댓글 자유도 vs 스팸 방지 | 자유로운 의견 vs 악성 댓글 | 신고 기능 + 키워드 필터링 + 차단 |
| 링크 영구성 vs 저장 비용 | 오래된 공유 링크 vs 서버 용량 | 1년 후 자동 아카이브, 접근 시 복원 옵션 |

---

## 7. 기능별 상세 명세

### 7-1. 공유 링크 구조
```
URL Format:
https://hotly.app/share/{shareId}?view=map
https://hotly.app/share/{shareId}?view=timeline

Query Parameters:
- view: map|timeline|both (기본값: both)
- lang: ko|en (언어 설정)
- theme: light|dark (테마)
```

### 7-2. 권한 레벨
```
권한 종류:
├── 🔒 Private: 링크 생성자만 접근
├── 👀 View Only: 링크 보유자 열람만 가능
├── 💬 Comment: 열람 + 댓글 작성 가능
├── ✏️ Edit: 열람 + 댓글 + 코스 편집 가능
└── 👑 Owner: 모든 권한 + 삭제 가능
```

### 7-3. 공유 데이터 스키마
```json
{
  "shareId": "string (8자리 고유 ID)",
  "courseId": "string",
  "createdBy": "userId",
  "permission": "enum[view|comment|edit]",
  "expiresAt": "timestamp?",
  "accessCount": "number",
  "lastAccessedAt": "timestamp",
  "comments": [
    {
      "id": "string",
      "placeId": "string?",
      "userId": "string",
      "content": "string",
      "createdAt": "timestamp",
      "reactions": {"👍": 3, "❤️": 1}
    }
  ],
  "editHistory": [
    {
      "userId": "string",
      "action": "add|remove|reorder",
      "target": "placeId",
      "timestamp": "timestamp"
    }
  ]
}
```

### 7-4. 실시간 동기화
- **기술스택:** WebSocket 또는 Server-Sent Events
- **동기화 범위:** 댓글, 반응, 코스 편집사항
- **충돌 해결:** Last-Writer-Wins + 충돌 알림
- **오프라인 지원:** 로컬 캐시 + 온라인 복귀 시 동기화

---

## 8. KPI / 측정 지표

### 8-1. 공유 성과
- **공유율:** 생성된 코스 중 공유 링크 생성 비율 ≥ 40%
- **접근률:** 공유 링크 생성 → 실제 접근 비율 ≥ 70%
- **복사율:** 공유받은 코스를 개인 계정에 복사하는 비율 ≥ 25%

### 8-2. 협업 참여도
- **댓글 참여:** 공유받은 코스에 댓글 작성 비율 ≥ 30%
- **편집 참여:** 편집 권한 제공 시 실제 편집 참여율 ≥ 60%
- **반응 참여:** 장소별 좋아요/싫어요 반응 비율 ≥ 50%

### 8-3. 기술 성능
- **링크 생성 속도:** 평균 응답시간 ≤ 3초
- **실시간 동기화:** 변경사항 반영 지연시간 ≤ 2초
- **크로스 플랫폼:** 모바일/웹 호환성 ≥ 98%

---

## 9. UI/UX 가이드라인

### 9-1. 공유 버튼 위치
```
코스 상세 화면:
┌─────────────────────────┐
│ 🎯 주말 홍대 데이트      │ ← 코스 제목
│ 📅 2024.03.15 (토)      │
│ [편집] [공유] [시작]     │ ← 공유 버튼 중앙
├─────────────────────────┤
│ 📍 1. 카페 ABC          │
│    10:00 - 11:30       │
└─────────────────────────┘
```

### 9-2. 공유 옵션 모달
```
┌─────────────────────────┐
│ 🔗 코스 공유하기         │
│                         │
│ 권한 설정:              │
│ ○ 보기만 ○ 댓글 ● 편집   │
│                         │
│ 만료일: [1주일 ▼]       │
│                         │
│ 🔗 링크 복사             │
│ 💬 카톡 공유             │
│ 📱 QR 코드              │
└─────────────────────────┘
```

### 9-3. 공유받은 코스 화면
```
┌─────────────────────────┐
│ 👤 민수님이 공유한 코스   │ ← 공유자 표시
│ 🎯 주말 홍대 데이트      │
│ [내 계정에 복사] [댓글]   │ ← 액션 버튼
├─────────────────────────┤
│ 📍 1. 카페 ABC          │
│ 💬 "여기 분위기 좋대!"   │ ← 댓글
│ 👍 3  💬 2              │ ← 반응
└─────────────────────────┘
```

---

## 10. 접근성 / 국제화

### 10-1. 접근성
- **스크린리더:** 공유 상태와 권한 레벨 음성 안내
- **키보드 탐색:** 댓글 작성/편집을 키보드만으로 가능
- **색상 독립성:** 권한별 구분을 아이콘 + 색상 조합
- **저시력:** 댓글 텍스트 크기 확대 옵션

### 10-2. 국제화
- **공유 메시지:** "Check out this course I planned!" 등 다국어
- **권한 설명:** View/Comment/Edit 권한별 설명 번역
- **시간대:** 댓글 작성시간을 현지 시간대로 표시
- **링크 도메인:** 지역별 도메인 (hotly.co.kr, hotly.com)

---

## 11. 보안 및 프라이버시

### 11-1. 링크 보안
- **고유성:** 8자리 alphanumeric (36^8 = 2.8조 조합)
- **예측 불가:** 순차 생성이 아닌 랜덤 생성
- **접근 제어:** IP/디바이스 기반 의심 접근 차단
- **만료 관리:** 기본 1년, 사용자 설정 가능

### 11-2. 개인정보 보호
- **익명화:** 공유 시 민감 개인정보 자동 마스킹
- **로그 관리:** 접근 로그 6개월 보관 후 삭제
- **삭제 권리:** 공유자가 언제든 링크 삭제 가능
- **데이터 최소화:** 필요한 정보만 공유 범위 포함

---

## 12. 외부 연동

### 12-1. 메신저 연동
- **카카오톡:** 링크 미리보기 + 썸네일 이미지
- **라인:** Open Graph 메타태그 지원
- **문자메시지:** 단축 URL + QR 코드 이미지

### 12-2. SNS 공유
- **인스타그램:** 스토리 공유용 이미지 자동 생성
- **페이스북:** 코스 정보가 포함된 미리보기
- **트위터:** 해시태그 + 썸네일 자동 생성

---

## 13. 용어 사전(Glossary)
- **공유 링크:** 타인이 접근할 수 있는 고유 URL
- **권한 레벨:** 공유받은 사용자가 할 수 있는 행동 범위
- **실시간 동기화:** 여러 사용자의 변경사항이 즉시 반영되는 기능
- **코스 복사:** 다른 사용자의 코스를 내 계정으로 가져오는 기능
- **편집 히스토리:** 코스 변경 내역을 시간순으로 기록한 로그

---

## 14. 기술 제약
- **동시 편집자:** 최대 10명까지 실시간 협업 지원
- **댓글 길이:** 개당 500자 제한
- **링크 수명:** 기본 1년, 최대 3년 설정 가능
- **실시간 동기화:** WebSocket 연결 유지 (모바일 백그라운드 5분)

---

## Changelog
- 2025-01-XX: 초기 문서 작성 (작성자: Claude)
