# PRD: 검색, 필터링, 정렬 기능

## 1. 기능 개요
**핵심 가치:** 축적된 장소와 코스 데이터에서 사용자가 원하는 조건에 맞는 정보를 빠르고 정확하게 찾을 수 있도록 다양한 검색/필터/정렬 옵션을 제공한다.

**사용자 이점:** 수십 개의 저장된 장소나 코스 중에서 현재 상황과 기분에 딱 맞는 옵션을 3초 내에 찾아서 즉시 활용할 수 있다.

---

## 2. 페르소나(Persona)
**주 사용자:** 소희(24세, 대학생)
- **맥락:** 6개월간 사용하며 위시리스트에 50여 개 장소를 저장했지만, 원하는 장소를 찾기 어려워짐
- **목표:** "홍대 근처 카페 중에서 조용하고 저렴한 곳"처럼 구체적 조건으로 빠르게 검색하고 싶음
- **동기:** 매번 스크롤하며 찾는 시간을 줄이고, 상황에 맞는 최적의 선택을 하고 싶음
- **제약:** 복잡한 필터 조합은 어렵고, 검색 결과가 0개면 좌절감
- **성공 정의:** 3초 내 원하는 장소 발견, 검색 결과 만족도 80% 이상

**핵심 Pain Points:**
1. **정보 과부하:** 저장된 장소가 많아질수록 원하는 것 찾기 어려움
2. **상황적 검색 한계:** "오늘 비오는데 실내에서" 같은 상황적 조건 반영 어려움
3. **검색 실패 스트레스:** 원하는 조건 검색 시 결과 0개로 빈 화면

---

## 3. 유저 스토리(User Stories)
- **효율적 탐색자**로서, 장소명이나 지역명으로 빠르게 검색하고 싶다. 그래서 스크롤 없이 원하는 장소를 찾는다.
- **조건부 선택자**로서, "카페 + 홍대 + 조용한"처럼 여러 조건을 조합해서 필터링하고 싶다. 그래서 현재 상황에 딱 맞는 장소를 찾는다.
- **우선순위 고려자**로서, 거리/평점/가격/최근 저장 순으로 정렬하고 싶다. 그래서 내 우선순위에 맞는 순서로 결과를 본다.
- **탐험 추구자**로서, 아직 안 가본 곳만 따로 볼 수 있는 필터가 있으면 좋겠다. 그래서 새로운 경험을 우선적으로 시도한다.

---

## 4. 유저 플로우(User Flow)

### 4-1. 기본 검색 플로우
1. **검색어 입력:** 상단 검색바에 장소명/지역명/키워드 입력
2. **자동완성:** 입력 중 관련 키워드 실시간 제안
3. **검색 실행:** Enter 또는 제안 선택으로 검색 실행
4. **결과 표시:** 일치 순서대로 장소/코스 리스트 표시
5. **검색 기록:** 최근 검색어 저장 및 빠른 재검색 지원

### 4-2. 필터 적용 플로우
1. **필터 진입:** "필터" 버튼으로 필터 패널 열기
2. **조건 선택:** 카테고리, 지역, 태그, 상태, 가격대 등 다중 선택
3. **실시간 반영:** 조건 변경 시마다 결과 개수 실시간 업데이트
4. **필터 적용:** "적용하기" 버튼으로 메인 리스트에 반영
5. **필터 관리:** 적용된 필터 태그 표시 및 개별 제거 가능

### 4-3. 정렬 및 보기 옵션 플로우
1. **정렬 선택:** 거리순/평점순/최근순/가격순 드롭다운 선택
2. **즉시 적용:** 선택과 동시에 리스트 순서 재배열
3. **보기 변경:** 리스트/카드/지도 뷰 전환
4. **결과 저장:** 현재 검색/필터/정렬 상태를 "저장된 검색"으로 보관
5. **공유:** 검색 결과를 링크로 공유

### 4-4. 빈 결과/에러 플로우
- **검색 결과 없음:** "검색 결과가 없어요" + 비슷한 키워드 제안
- **필터 과다:** "조건이 너무 구체적이에요" + 일부 조건 완화 제안
- **네트워크 오류:** 캐시된 기본 검색 결과로 대체 표시
- **검색 오류:** "다시 시도해주세요" + 인기 검색어 추천

---

## 5. 수용 기준(Acceptance Criteria)

| ID | 시나리오 | Given | When | Then |
|----|----------|-------|------|------|
| AC-01 | 실시간 검색 | 검색어 입력 중 | 2글자 이상 입력 시 | 500ms 이내 자동완성 제안 표시 |
| AC-02 | 검색 속도 | 검색어 입력 완료 | 검색 실행 시 | 3초 이내 결과 표시 (100개 장소 기준) |
| AC-03 | 필터 조합 | 여러 필터 조건 선택 | 필터 적용 시 | AND 조건으로 정확한 교집합 결과 표시 |
| AC-04 | 정렬 정확성 | 거리순 정렬 선택 | 현재 위치 기준 | GPS 위치에서 가까운 순서대로 배열 |
| AC-05 | 검색 기록 | 이전 검색 수행 | 검색바 터치 시 | 최근 10개 검색어 드롭다운 표시 |
| AC-06 | 무한 스크롤 | 검색 결과 20개 이상 | 리스트 하단 도달 시 | 추가 20개 결과 자동 로딩 |
| AC-07 | 필터 초기화 | 필터 적용된 상태 | "전체 초기화" 버튼 클릭 | 모든 필터 해제하고 전체 결과 표시 |

---

## 6. 상충/의존성 점검(Conflict Matrix)

| 항목 | 잠재 충돌 | 정책/해결 |
|------|-----------|-----------|
| 검색 속도 vs 정확도 | 빠른 응답 vs 완전한 결과 | 1차 빠른 검색 후 백그라운드에서 정밀 검색 보완 |
| 필터 다양성 vs 복잡성 | 세밀한 조건 vs 사용 편의 | 기본/고급 필터로 분리, 기본 필터 우선 노출 |
| 개인화 vs 일반성 | 맞춤 결과 vs 객관적 순서 | 사용자 설정에서 개인화 강도 조절 옵션 |
| 실시간 vs 성능 | 타이핑마다 검색 vs 서버 부하 | 디바운싱(300ms) + 캐싱으로 요청 최적화 |

---

## 7. 기능별 상세 명세

### 7-1. 검색 대상 및 우선순위
```
검색 범위:
├── 1순위: 장소명 (완전일치 > 부분일치)
├── 2순위: 주소/지역명 (구/동 단위)
├── 3순위: 사용자 태그 (#조용한, #분위기좋은)
├── 4순위: 카테고리 (카페, 맛집 등)
└── 5순위: 메모/설명 (사용자 입력 텍스트)

검색 알고리즘:
- 한글/영문 동시 지원 (ㅋㅏㅍㅔ = 카페)
- 초성 검색 (ㅋㅍ = 카페)
- 오타 허용 (편집 거리 2 이내)
- 동의어 매칭 (맛집 = 식당 = 레스토랑)
```

### 7-2. 필터 카테고리
```
🏷️ 카테고리:
☑️ 카페    ☑️ 맛집    ☑️ 관광지
☑️ 쇼핑    ☑️ 문화    ☑️ 액티비티

📍 지역:
☑️ 강남    ☑️ 홍대    ☑️ 명동
☑️ 건대    ☑️ 신촌    ☑️ 기타

🏷️ 사용자 태그:
☑️ 조용한   ☑️ 넓은    ☑️ 저렴한
☑️ 힙한    ☑️ 깔끔한   ☑️ 뷰좋은

📊 상태:
☑️ 가보고싶음  ☑️ 즐겨찾기  ☑️ 방문예정
☑️ 방문완료   ☑️ 아직 안감

💰 가격대:
☑️ ~1만원   ☑️ 1-2만원  ☑️ 2-3만원
☑️ 3-5만원  ☑️ 5만원+
```

### 7-3. 정렬 옵션
```
정렬 기준:
├── 📍 거리순 (가까운 순, GPS 기반)
├── ⭐ 평점순 (높은 순, 리뷰 기반)
├── 🕒 최근순 (최근 저장/수정 순)
├── 💰 가격순 (저렴한 순 / 비싼 순)
├── 📊 인기순 (저장/방문 많은 순)
└── 🔤 이름순 (가나다 순)

기본값: 최근순 (개인화)
```

### 7-4. 검색 API 스키마
```json
{
  "query": "string",
  "filters": {
    "categories": "string[]",
    "regions": "string[]",
    "tags": "string[]",
    "status": "string[]",
    "priceRange": "string[]"
  },
  "sort": {
    "field": "distance|rating|recent|price|popular|name",
    "order": "asc|desc"
  },
  "pagination": {
    "page": "number",
    "limit": "number (default: 20)"
  },
  "location": {
    "lat": "number?",
    "lng": "number?"
  }
}
```

---

## 8. KPI / 측정 지표

### 8-1. 검색 성능
- **검색 속도:** 평균 응답시간 ≤ 2초
- **자동완성 속도:** 타이핑 후 500ms 이내 제안
- **검색 성공률:** 결과 1개 이상 반환 비율 ≥ 85%

### 8-2. 사용자 만족도
- **클릭률:** 검색 결과 → 장소 상세 클릭 ≥ 40%
- **재검색률:** 첫 검색 후 조건 수정 비율 ≤ 30%
- **필터 사용률:** 검색 시 필터 적용 비율 ≥ 25%

### 8-3. 기능 활용도
- **검색 빈도:** 사용자당 월평균 검색 횟수 ≥ 15회
- **정렬 활용:** 기본 정렬 외 다른 정렬 사용 비율 ≥ 30%
- **저장된 검색:** 검색 조건 저장 기능 사용률 ≥ 10%

---

## 9. UI/UX 가이드라인

### 9-1. 검색바 디자인
```
┌─────────────────────────┐
│ 🔍 장소명, 지역, 태그 검색 │ ← 플레이스홀더
│ [x] 홍대 카페              │ ← 입력 중 상태
│ ↓ 자동완성 드롭다운          │
│ • 홍대 카페 (장소 12개)     │
│ • 홍대 맛집 (장소 8개)      │
│ • #홍대감성 태그           │
└─────────────────────────┘
```

### 9-2. 필터 UI
```
┌─────────────────────────┐
│ 🎛️ 필터                │
├─────────────────────────┤
│ 카테고리                 │
│ [카페][맛집][관광지][+]    │
│                         │
│ 지역                    │
│ [홍대][강남][신촌][+]     │
│                         │
│ 상태                    │
│ [가보고싶음][즐겨찾기]     │
│                         │
│ [초기화]        [적용]   │
└─────────────────────────┘
```

### 9-3. 결과 리스트
```
┌─────────────────────────┐
│ [리스트] [카드] [지도]     │ ← 보기 옵션
│ 정렬: 거리순 ▼ | 필터 🎛️  │
├─────────────────────────┤
│ 🔍 "홍대 카페" 검색결과     │
│ [#카페][#홍대] ❌        │ ← 적용된 필터
├─────────────────────────┤
│ ☕ 카페 ABC     200m     │
│ ⭐ 4.2 | 💰 1만원대      │
│ #조용한 #와이파이좋음      │
├─────────────────────────┤
│ ... 더 많은 결과          │
└─────────────────────────┘
```

---

## 10. 접근성 / 국제화

### 10-1. 접근성
- **스크린리더:** 검색 결과 개수와 필터 상태 음성 안내
- **키보드 탐색:** Tab 키로 검색→필터→결과 순서 이동
- **고대비:** 선택된 필터와 미선택 필터 명확한 시각적 구분
- **터치:** 필터 체크박스 최소 44px 터치 영역

### 10-2. 국제화
- **검색어:** 한글/영문 혼용 입력 지원
- **지역명:** 한국어/영어 병기 (Hongdae/홍대)
- **정렬 기준:** 거리 단위 자동 전환 (km/mile)
- **가격:** 통화 단위 지역별 표시 (₩/$/¥)

---

## 11. 성능 최적화

### 11-1. 검색 인덱싱
```
Elasticsearch 인덱스 구조:
{
  "mappings": {
    "properties": {
      "name": {"type": "text", "analyzer": "korean"},
      "address": {"type": "text", "analyzer": "korean"},
      "category": {"type": "keyword"},
      "tags": {"type": "keyword"},
      "location": {"type": "geo_point"},
      "rating": {"type": "float"},
      "price_range": {"type": "integer"},
      "created_at": {"type": "date"}
    }
  }
}
```

### 11-2. 캐싱 전략
- **인기 검색어:** Redis에 30분 TTL로 결과 캐싱
- **필터 조합:** 자주 사용되는 조합 1시간 캐싱
- **사용자별 검색:** 개인 검색 기록 로컬 스토리지
- **지역 기반:** GPS 기준 반경 1km 검색 결과 캐싱

### 11-3. 최적화 기법
- **디바운싱:** 검색어 입력 300ms 후 API 호출
- **무한 스크롤:** 20개씩 페이지네이션
- **지연 로딩:** 화면에 보이는 이미지만 로딩
- **압축:** 검색 결과 JSON 압축 전송

---

## 12. 외부 연동

### 12-1. 검색 엔진
- **주 사용:** PostgreSQL trigram + Elasticsearch (전문 검색)
- **보조:** PostgreSQL full-text search (백업)
- **실시간:** Redis (자동완성, 캐싱)

### 12-2. 위치 서비스
- **거리 계산:** Haversine 공식 (정확도 ±100m)
- **주소 검색:** 카카오 지도 API (한국 주소)
- **지역 분류:** 행정구역 API (구/동 단위)

---

## 13. 고급 기능

### 13-1. 스마트 검색
```
AI 기반 의도 파악:
- "오늘 비온다" → 실내 장소 우선 표시
- "저렴하게" → 가격대 낮은 순 자동 정렬
- "혼자" → 1인 적합 태그 필터 적용
- "데이트" → 분위기 좋은 장소 우선
```

### 13-2. 저장된 검색
- **즐겨찾는 검색:** 자주 쓰는 조건 조합 저장
- **알림 설정:** 조건에 맞는 새 장소 추가 시 알림
- **공유:** 검색 조건을 링크로 공유 가능

### 13-3. 검색 분석
- **트렌드:** 인기 급상승 검색어 주간 리포트
- **개인화:** 검색 패턴 기반 맞춤 추천
- **통계:** 내 검색 기록 월간 요약

---

## 14. 용어 사전(Glossary)
- **자동완성:** 입력 중인 검색어를 예측해서 후보를 제시하는 기능
- **필터링:** 특정 조건에 맞는 결과만 걸러내는 기능
- **정렬:** 결과를 특정 기준으로 순서를 재배열하는 기능
- **디바운싱:** 연속된 입력에서 마지막 입력만 처리하는 최적화 기법
- **인덱싱:** 빠른 검색을 위해 데이터를 구조화하여 저장하는 방식

---

## 15. 기술 제약
- **검색 속도:** 평균 응답시간 3초 이내 보장
- **동시 검색:** 1000명 동시 검색 처리 가능
- **인덱스 크기:** 100만 개 장소 검색 지원
- **필터 조합:** 최대 10개 조건 동시 적용

---

## Changelog
- 2025-01-XX: 초기 문서 작성 (작성자: Claude)
