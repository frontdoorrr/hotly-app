# 사용자 플로우 정의 (User Flows)

## 문서 정보
- **버전**: 1.0
- **작성일**: 2025-01-XX
- **작성자**: Development Team
- **관련 PRD**: `prd/01-sns-link-analysis.md`, `prd/02-place-management.md`, `prd/06-onboarding-flow.md`
- **관련 TRD**: `trd/frontend/01-flutter-tech-stack.md`
- **관련 Task**: `task/06-ui-frontend.md`

## 목차
1. [개요](#1-개요)
2. [핵심 사용자 여정](#2-핵심-사용자-여정)
3. [Flow 1: 온보딩](#3-flow-1-온보딩)
4. [Flow 2: 링크 분석 및 장소 저장](#4-flow-2-링크-분석-및-장소-저장)
5. [Flow 3: 장소 검색 및 필터링](#5-flow-3-장소-검색-및-필터링)
6. [Flow 4: 코스 생성](#6-flow-4-코스-생성)
7. [Flow 5: 공유 및 협업](#7-flow-5-공유-및-협업)
8. [에러 플로우](#8-에러-플로우)
9. [화면 전환 다이어그램](#9-화면-전환-다이어그램)

---

## 1. 개요

### 1.1 목적
사용자가 hotly 앱에서 수행하는 핵심 여정을 단계별로 정의하여 일관된 UX를 제공하고, 개발 및 테스트 시 기준으로 활용한다.

### 1.2 페르소나 기반 플로우
- **민지 (27세, 데이트 플래너)**: 링크 분석 → 장소 저장 → 코스 생성
- **준호 (32세, 맛집 탐방가)**: 검색 → 필터링 → 저장
- **수영 (25세, 소셜 공유러)**: 장소 발견 → 공유 → 협업

---

## 2. 핵심 사용자 여정

### 2.1 사용자 여정 맵

```
신규 사용자 → 온보딩 → 홈 화면 → 기능 탐색
                ↓
        링크 분석 / 검색 / 추천
                ↓
            장소 저장
                ↓
            코스 생성
                ↓
        공유 및 피드백
```

### 2.2 핵심 액션별 예상 소요 시간

| 액션 | 예상 시간 | 목표 시간 |
|------|-----------|-----------|
| 온보딩 완료 | 2-3분 | < 3분 |
| 링크 분석 및 장소 저장 | 30초 | < 1분 |
| 장소 검색 및 저장 | 1분 | < 1.5분 |
| 코스 생성 (3개 장소) | 3분 | < 5분 |
| 공유 | 10초 | < 30초 |

---

## 3. Flow 1: 온보딩

### 3.1 사용자 목표
- 앱의 핵심 기능 이해
- 개인화 설정 (관심사, 선호 카테고리)
- 첫 장소 발견 및 저장

### 3.2 플로우 단계

```
1. 스플래시 화면 (3초)
   ↓
2. 온보딩 Step 1/5: 환영 화면
   - 제목: "hotly에 오신 것을 환영합니다"
   - 부제: "AI가 SNS 링크에서 장소를 찾아드려요"
   - CTA: [시작하기]
   ↓
3. 온보딩 Step 2/5: 관심사 선택
   - 제목: "어떤 장소에 관심이 있나요?"
   - 옵션: [카페, 맛집, 관광지, 데이트, 액티비티, 쇼핑]
   - 다중 선택 가능 (최소 1개)
   - CTA: [다음]
   ↓
4. 온보딩 Step 3/5: 지역 설정
   - 제목: "주로 활동하는 지역은 어디인가요?"
   - GPS 권한 요청
   - 수동 검색 옵션
   - CTA: [다음] / [건너뛰기]
   ↓
5. 온보딩 Step 4/5: 알림 설정
   - 제목: "새로운 장소 추천을 받아보세요"
   - FCM 권한 요청
   - CTA: [알림 받기] / [나중에]
   ↓
6. 온보딩 Step 5/5: 튜토리얼
   - 제목: "링크 붙여넣기로 장소 찾기"
   - 애니메이션: 링크 분석 과정 시연
   - CTA: [시작하기]
   ↓
7. 홈 화면
   - 개인화된 추천 장소 표시
   - 빠른 액세스: [링크 분석] [검색] [코스]
```

### 3.3 분기 처리

**분기 1: 권한 거부**
```
GPS 권한 거부 → "나중에 설정에서 변경 가능합니다" 안내 → 다음 단계
알림 권한 거부 → "설정에서 언제든 활성화 가능합니다" 안내 → 홈 화면
```

**분기 2: 건너뛰기**
```
Step 2-4 건너뛰기 → 기본 설정으로 진행 → 홈 화면
(나중에 설정에서 변경 가능)
```

### 3.4 수용 기준

- **Given** 신규 사용자가 앱 설치
- **When** 최초 실행
- **Then** 온보딩 5단계를 3분 이내 완료, 홈 화면 진입

---

## 4. Flow 2: 링크 분석 및 장소 저장

### 4.1 사용자 목표
- SNS 링크에서 장소 정보 추출
- 장소를 내 리스트에 저장
- 카테고리 및 태그 지정

### 4.2 플로우 단계

```
1. 홈 화면
   ↓
2. [링크 분석] 버튼 탭
   ↓
3. 링크 입력 화면
   - 제목: "어떤 장소를 찾으셨나요?"
   - 입력 필드: URL 붙여넣기 (자동 클립보드 감지)
   - 지원 플랫폼 표시: Instagram, 네이버 블로그, YouTube
   - CTA: [분석하기]
   ↓
4. 링크 분석 중 (로딩)
   - 프로그레스 바 + 애니메이션
   - 예상 소요 시간: "약 5초 소요됩니다"
   - 상태: "링크 내용 읽는 중..." → "장소 정보 찾는 중..."
   ↓
5. 분석 결과 화면
   - 추출된 장소 정보:
     * 장소명
     * 카테고리 (AI 자동 분류)
     * 주소
     * 대표 이미지
     * 설명 (SNS 콘텐츠에서 추출)
     * 신뢰도 점수 (60% 이상)
   - CTA: [저장하기] [다시 분석] [취소]
   ↓
6. 장소 편집 (선택적)
   - 장소명 수정
   - 카테고리 변경
   - 태그 추가 (#데이트 #조용한 #뷰맛집)
   - 메모 추가
   - CTA: [저장]
   ↓
7. 저장 완료
   - 토스트 메시지: "장소가 저장되었습니다"
   - 옵션:
     * [코스에 추가하기]
     * [공유하기]
     * [더 찾기]
     * [닫기]
   ↓
8. 홈 화면 / 내 장소 목록
```

### 4.3 분기 처리

**분기 1: 링크 분석 실패**
```
분석 실패 → 에러 화면
- 원인: "링크에서 장소 정보를 찾을 수 없습니다"
- 제안:
  * 다른 링크 시도
  * 수동으로 장소 추가
  * 검색으로 찾기
- CTA: [다시 시도] [수동 입력] [검색하기]
```

**분기 2: 낮은 신뢰도 (<60%)**
```
신뢰도 낮음 → 경고 표시
- "AI 분석 결과가 불확실합니다 (신뢰도 45%)"
- "정보를 확인하고 수정해주세요"
- 필드: 수정 가능 (장소명, 주소, 카테고리)
- CTA: [수정 후 저장] [취소]
```

**분기 3: 중복 장소**
```
중복 감지 → 알림
- "이미 저장된 장소입니다"
- 기존 장소 정보 표시
- CTA: [기존 장소 보기] [새로 저장] [취소]
```

### 4.4 성능 요구사항

| 단계 | 목표 시간 |
|------|-----------|
| 링크 붙여넣기 → 분석 시작 | < 0.5초 |
| 분석 완료 (API 응답) | < 5초 (p95) |
| 결과 화면 렌더링 | < 0.3초 |
| 저장 완료 | < 1초 |

### 4.5 수용 기준

- **Given** 사용자가 Instagram 장소 게시물 링크 복사
- **When** 링크 분석 버튼 탭 → URL 붙여넣기 → 분석하기
- **Then** 5초 이내 장소 정보 추출, 신뢰도 60% 이상, 저장 완료

---

## 5. Flow 3: 장소 검색 및 필터링

### 5.1 사용자 목표
- 키워드로 장소 검색
- 필터로 원하는 조건의 장소 찾기
- 장소 상세 정보 확인 및 저장

### 5.2 플로우 단계

```
1. 홈 화면
   ↓
2. 하단 탭바 [검색] 탭
   ↓
3. 검색 화면
   - 검색바: "장소, 주소, 태그 검색"
   - 최근 검색어 (최대 10개)
   - 인기 검색어
   - 추천 카테고리: [카페] [맛집] [데이트]
   ↓
4. 검색어 입력
   - 실시간 자동완성 (3글자 이상)
   - 추천 장소 미리보기
   ↓
5. 검색 결과 화면
   - 결과 개수 표시: "서울 카페 132개"
   - 정렬: [추천순] [거리순] [평점순] [최신순]
   - 필터 버튼 (Badge: 활성 필터 개수 표시)
   - 뷰 전환: [리스트] / [지도]
   ↓
6a. 리스트 뷰
    - 장소 카드 (무한 스크롤)
      * 썸네일 이미지
      * 장소명
      * 카테고리 배지
      * 평점 ★★★★☆ (4.5)
      * 거리 (500m)
      * 좋아요 버튼
      * 저장 버튼
    ↓
6b. 지도 뷰
    - 카카오맵 + 마커
    - 클러스터링 (마커 많을 때)
    - 하단 시트: 선택된 장소 카드
    ↓
7. 필터 적용 (선택적)
   - 카테고리: [전체] [카페] [맛집] [관광지] ...
   - 거리: 500m / 1km / 3km / 5km / 전체
   - 평점: 전체 / 4.0 이상 / 4.5 이상
   - 태그: #데이트 #조용한 #뷰맛집 ...
   - CTA: [초기화] [적용]
   ↓
8. 필터 적용된 결과
   - "필터 적용 (3개)" 표시
   - 결과 재검색
   ↓
9. 장소 카드 탭 → 장소 상세 화면
   ↓
10. 장소 상세 화면
    - 이미지 갤러리 (스와이프)
    - 장소명 + 카테고리
    - 평점 및 리뷰 수
    - 주소 + 지도 보기
    - 설명
    - 태그
    - 액션 버튼:
      * [좋아요] (토글)
      * [저장하기]
      * [공유하기]
      * [경로 찾기]
    - 리뷰 섹션 (미리보기)
    ↓
11. [저장하기] 탭
    ↓
12. 저장 옵션 바텀시트
    - 폴더 선택: [기본] [데이트] [맛집] [여행] ...
    - 새 폴더 만들기
    - 메모 추가 (선택적)
    - CTA: [저장]
    ↓
13. 저장 완료
    - 토스트: "장소가 저장되었습니다"
    - 옵션: [코스에 추가] [공유] [닫기]
```

### 5.3 분기 처리

**분기 1: 검색 결과 없음**
```
결과 0개 → 빈 상태 화면
- 아이콘 + 메시지: "검색 결과가 없습니다"
- 제안:
  * 다른 키워드로 검색
  * 필터 조건 완화
  * 직접 추가하기
- CTA: [검색 다시하기] [직접 추가]
```

**분기 2: 네트워크 오류**
```
API 실패 → 에러 화면
- "인터넷 연결을 확인해주세요"
- 캐시된 검색 결과 표시 (있는 경우)
- CTA: [다시 시도] [오프라인 저장 장소 보기]
```

**분기 3: 위치 권한 없음 (거리순 정렬 시)**
```
GPS 권한 없음 → 권한 요청 다이얼로그
- "거리순 정렬을 위해 위치 권한이 필요합니다"
- CTA: [권한 설정] [취소]
→ 취소 시: 추천순으로 정렬
```

### 5.4 수용 기준

- **Given** 사용자가 "강남 카페" 검색
- **When** 검색어 입력 → 엔터
- **Then** 1초 이내 검색 결과 표시, 필터 적용 가능, 장소 저장 가능

---

## 6. Flow 4: 코스 생성

### 6.1 사용자 목표
- 여러 장소를 조합하여 데이트/여행 코스 생성
- 순서 조정 및 소요 시간 확인
- 코스 공유 및 저장

### 6.2 플로우 단계

```
1. 홈 화면 / 내 장소 화면
   ↓
2. [코스 만들기] 버튼 탭
   ↓
3. 코스 생성 화면
   - 제목: "새 코스 만들기"
   - 코스명 입력: "강남 데이트 코스"
   - 코스 타입 선택: [데이트] [여행] [맛집 투어] [카페 호핑]
   - 설명 (선택적)
   - 빈 타임라인 표시
   - CTA: [장소 추가]
   ↓
4. 장소 선택 화면
   - 탭: [내 장소] / [검색]
   - 내 장소: 저장된 장소 목록
   - 다중 선택 가능 (체크박스)
   - 선택된 개수 표시: "3개 선택됨"
   - CTA: [추가하기]
   ↓
5. 코스 편집 화면
   - 타임라인 뷰:
     ┌─ 1. 카페 A (10:00 - 11:30, 1.5시간)
     │  ├─ 이동 (도보 10분, 800m)
     ├─ 2. 레스토랑 B (12:00 - 13:30, 1.5시간)
     │  ├─ 이동 (차량 15분, 3.2km)
     └─ 3. 전망대 C (14:00 - 16:00, 2시간)

   - 각 장소 카드:
     * 드래그 핸들 (순서 변경)
     * 썸네일
     * 장소명
     * 예상 체류 시간 조정
     * [삭제] 버튼

   - 하단 정보:
     * 총 소요 시간: 5.5시간
     * 총 이동 거리: 4.0km

   - FAB: [장소 추가]
   - CTA: [미리보기] [저장]
   ↓
6. 순서 조정 (Drag & Drop)
   - 장소 카드 롱프레스
   - 드래그하여 순서 변경
   - 이동 경로 자동 재계산
   ↓
7. 미리보기 (선택적)
   - 지도 뷰: 전체 경로 표시
   - 타임라인 뷰: 시간별 일정
   - CTA: [편집으로 돌아가기] [저장]
   ↓
8. 저장 확인 다이얼로그
   - "코스를 저장하시겠습니까?"
   - 공개 설정:
     * [나만 보기] (기본)
     * [친구와 공유]
     * [전체 공개]
   - CTA: [저장] [취소]
   ↓
9. 저장 완료
   - 토스트: "코스가 저장되었습니다"
   - 옵션:
     * [코스 보기]
     * [공유하기]
     * [다른 코스 만들기]
     * [홈으로]
```

### 6.3 분기 처리

**분기 1: 장소 미선택**
```
장소 0개 → 저장 시도
- "최소 2개 이상의 장소를 추가해주세요"
- CTA: [장소 추가]
```

**분기 2: 경로 계산 실패**
```
이동 경로 API 오류
- "경로 계산에 실패했습니다"
- 대체: 직선 거리 표시
- "정확한 경로는 지도 앱에서 확인해주세요"
```

**분기 3: 저장 중 네트워크 오류**
```
API 실패 → 오프라인 저장
- "오프라인으로 저장되었습니다"
- "인터넷 연결 시 자동으로 동기화됩니다"
- 동기화 큐에 추가
```

### 6.4 인터랙션 가이드

**드래그 앤 드롭 순서 변경:**
```dart
// Reorderable List 사용
ReorderableListView(
  onReorder: (oldIndex, newIndex) {
    setState(() {
      if (newIndex > oldIndex) newIndex--;
      final place = places.removeAt(oldIndex);
      places.insert(newIndex, place);
    });
    // 햅틱 피드백
    HapticFeedback.mediumImpact();
  },
  children: places.map((place) => PlaceCard(place)).toList(),
);
```

**체류 시간 조정:**
```
Slider(
  min: 0.5,
  max: 4.0,
  divisions: 7,
  value: duration,
  label: '${duration}시간',
  onChanged: (value) => updateDuration(value),
);
```

### 6.5 수용 기준

- **Given** 사용자가 저장된 장소 3개 보유
- **When** 코스 만들기 → 장소 선택 → 순서 조정 → 저장
- **Then** 5분 이내 코스 생성 완료, 이동 경로 및 소요 시간 표시

---

## 7. Flow 5: 공유 및 협업

### 7.1 사용자 목표
- 장소/코스를 친구와 공유
- 공유받은 콘텐츠 저장
- 협업 코스 편집

### 7.2 플로우 단계

```
1. 장소 상세 화면 / 코스 상세 화면
   ↓
2. [공유하기] 버튼 탭
   ↓
3. 공유 옵션 바텀시트
   - 공유 방법:
     * [카카오톡]
     * [Instagram 스토리]
     * [링크 복사]
     * [QR 코드 생성]
   - 공유 설정:
     * [URL만 공유] (기본)
     * [이미지 + URL]
     * [상세 정보 포함]
   ↓
4a. 카카오톡 공유
    - 카카오톡 공유 SDK
    - 템플릿:
      * 썸네일 이미지
      * 제목: "민지님이 장소를 공유했어요"
      * 설명: "카페 A - 강남역 근처 분위기 좋은 카페"
      * 버튼: [hotly에서 보기]
    ↓
4b. Instagram 스토리
    - 이미지 + 스티커 생성
    - Instagram 앱 자동 실행
    - 스토리 작성 화면으로 이동
    ↓
4c. 링크 복사
    - 딥링크 URL 생성: hotly://place/123
    - 클립보드 복사
    - 토스트: "링크가 복사되었습니다"
    ↓
5. 공유 완료
   - Analytics 이벤트 전송
   - 토스트: "공유 완료"
```

### 7.3 수신자 플로우

```
1. 공유 링크 수신
   ↓
2. 링크 클릭
   ↓
3a. 앱 설치됨 → 앱 실행 (Deep Link)
    ↓
3b. 앱 미설치 → 웹 랜딩 페이지
    - 장소/코스 미리보기
    - CTA: [앱 다운로드]
    ↓
4. 장소/코스 상세 화면
   - "민지님이 공유한 장소입니다" 배너
   - CTA: [저장하기] [코스에 추가]
   ↓
5. 저장/추가 완료
```

### 7.4 수용 기준

- **Given** 사용자가 장소를 카카오톡으로 공유
- **When** 친구가 링크 클릭
- **Then** 앱에서 해당 장소 자동 열림, 저장 가능

---

## 8. 에러 플로우

### 8.1 네트워크 에러

```
API 호출 실패
  ↓
재시도 로직 (최대 3회, 지수 백오프)
  ↓
3회 실패 → 에러 화면
  - 아이콘 + 메시지: "인터넷 연결을 확인해주세요"
  - 캐시 데이터 표시 (가능한 경우)
  - CTA: [다시 시도] [오프라인 모드]
```

### 8.2 인증 에러

```
토큰 만료 / 인증 실패
  ↓
자동 토큰 갱신 시도
  ↓
갱신 실패 → 로그인 화면
  - 메시지: "다시 로그인해주세요"
  - CTA: [로그인]
```

### 8.3 권한 에러

```
GPS/알림 권한 필요
  ↓
권한 요청 다이얼로그
  ↓
거부 → 기능 제한 안내
  - "위치 권한이 없어 거리순 정렬을 사용할 수 없습니다"
  - CTA: [설정에서 허용] [나중에]
```

### 8.4 데이터 검증 에러

```
폼 입력 오류
  ↓
필드별 에러 메시지 표시
  - 빨간색 테두리 + 아이콘
  - "장소명을 입력해주세요" (필드 하단)
  ↓
첫 번째 에러 필드로 포커스
  ↓
수정 후 재검증
```

---

## 9. 화면 전환 다이어그램

### 9.1 메인 네비게이션 구조

```
┌─────────────────────────────────────────┐
│          스플래시 화면 (3초)              │
└───────────────┬─────────────────────────┘
                │
                ↓
┌───────────────────────────────────────────┐
│         온보딩 (5 Steps)                  │
│  1. 환영 → 2. 관심사 → 3. 지역 →         │
│  4. 알림 → 5. 튜토리얼                    │
└───────────────┬───────────────────────────┘
                │
                ↓
┌───────────────────────────────────────────┐
│         Bottom Navigation Bar             │
│  ┌────┬──────┬────────┬────────┬──────┐  │
│  │홈  │검색  │링크분석│코스    │프로필│  │
│  └────┴──────┴────────┴────────┴──────┘  │
└───────────────────────────────────────────┘
     │      │       │        │        │
     ↓      ↓       ↓        ↓        ↓
   홈화면  검색화면  링크입력  코스목록  프로필
     │      │       │        │        │
     ├──────┼───────┴────────┴────────┘
     │      │
     ↓      ↓
  장소상세  검색결과
     │      │
     └──────┴─→ 장소 저장 → 저장 완료
                    │
                    ↓
              코스에 추가? → 코스 편집
```

### 9.2 Modal/Overlay 화면

```
전체 화면 모달:
  - 온보딩
  - 링크 분석 결과
  - 장소 상세
  - 코스 생성/편집

바텀시트:
  - 공유 옵션
  - 저장 폴더 선택
  - 필터 옵션
  - 장소 선택 (코스 생성 시)

다이얼로그:
  - 확인/취소 (삭제, 저장 등)
  - 권한 요청
  - 에러 알림
```

### 9.3 화면 전환 애니메이션

```dart
// 화면 전환 기본 설정
PageRouteBuilder(
  pageBuilder: (context, animation, secondaryAnimation) => NextScreen(),
  transitionsBuilder: (context, animation, secondaryAnimation, child) {
    // Slide Transition (오른쪽에서 왼쪽으로)
    const begin = Offset(1.0, 0.0);
    const end = Offset.zero;
    const curve = Curves.easeInOut;

    var tween = Tween(begin: begin, end: end).chain(
      CurveTween(curve: curve),
    );

    return SlideTransition(
      position: animation.drive(tween),
      child: child,
    );
  },
  transitionDuration: Duration(milliseconds: 300),
);

// Modal Bottom Sheet
showModalBottomSheet(
  context: context,
  isScrollControlled: true,
  backgroundColor: Colors.transparent,
  builder: (context) => DraggableScrollableSheet(
    initialChildSize: 0.6,
    minChildSize: 0.3,
    maxChildSize: 0.9,
    builder: (context, scrollController) => FilterPanel(),
  ),
);

// Hero Transition (이미지)
Hero(
  tag: 'place_image_${place.id}',
  child: Image.network(place.imageUrl),
);
```

---

## 10. 완료 정의 (DoD)

### 10.1 플로우 정의 완료 기준
- [x] 핵심 플로우 5개 정의 (온보딩, 링크 분석, 검색, 코스 생성, 공유)
- [x] 각 플로우별 단계 및 화면 명세
- [x] 분기 처리 (에러, 예외 케이스) 정의
- [x] 수용 기준 (Given-When-Then) 작성

### 10.2 사용성 검증
- [x] 각 플로우 완료 시간 목표 설정
- [x] 핵심 액션 3 클릭 이내 도달 가능
- [x] 에러 복구 경로 존재
- [x] 빈 상태(Empty State) 처리 정의

---

## 11. 참고 문서

- **내부 문서**:
  - `prd/01-sns-link-analysis.md`: 링크 분석 기능 요구사항
  - `prd/02-place-management.md`: 장소 관리 기능
  - `prd/06-onboarding-flow.md`: 온보딩 상세 요구사항
  - `ui-design-system.md`: UI 컴포넌트 가이드라인

---

## 12. Changelog

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 2025-01-XX | 1.0 | 최초 작성 - 핵심 사용자 플로우 5개 정의 | Development Team |

---

*이 문서는 살아있는 문서(Living Document)로, UX 개선 시 즉시 업데이트됩니다.*
