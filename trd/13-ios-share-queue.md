# TRD: iOS ê³µìœ  í ì‹œìŠ¤í…œ - ì¼ê´„ ë¶„ì„ ì•„í‚¤í…ì²˜

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1-1. ì•„í‚¤í…ì²˜ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     External Apps                            â”‚
â”‚            (Instagram, Blog, YouTube)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ iOS Share Sheet
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 iOS Share Extension                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ URL Extractorâ”‚  â”‚ Domain Filterâ”‚  â”‚ Queue Writer â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                            â”‚                                 â”‚
â”‚                            â–¼                                 â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                   â”‚  App Groups    â”‚                        â”‚
â”‚                   â”‚  UserDefaults  â”‚                        â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Flutter Main App                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚          Presentation Layer                  â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚           â”‚
â”‚  â”‚  â”‚ Queue Badge  â”‚  â”‚ Processing   â”‚         â”‚           â”‚
â”‚  â”‚  â”‚ Widget       â”‚  â”‚ Sheet        â”‚         â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â”‚
â”‚  â”‚         â”‚                  â”‚                  â”‚           â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚           â”‚
â”‚  â”‚                    â”‚                          â”‚           â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚           â”‚
â”‚  â”‚         â”‚ Results Review Screenâ”‚              â”‚           â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                   â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚          State Management (Riverpod)          â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚
â”‚  â”‚  â”‚    ShareQueueNotifier                â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  â”‚ Queue      â”‚  â”‚ Batch      â”‚     â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  â”‚ Manager    â”‚  â”‚ Processor  â”‚     â”‚    â”‚           â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚           â”‚
â”‚  â”‚  â”‚        â”‚                â”‚            â”‚    â”‚           â”‚
â”‚  â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚    â”‚           â”‚
â”‚  â”‚  â”‚                 â”‚                    â”‚    â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                       â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚          Data Layer                          â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚           â”‚
â”‚  â”‚  â”‚ Local        â”‚  â”‚ Remote       â”‚         â”‚           â”‚
â”‚  â”‚  â”‚ Storage      â”‚  â”‚ Data Source  â”‚         â”‚           â”‚
â”‚  â”‚  â”‚(SharedPrefs) â”‚  â”‚(Link Analysisâ”‚         â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â”‚
â”‚  â”‚         â”‚                  â”‚                  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                  â”‚
             â”‚                  â–¼
             â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚         â”‚  FastAPI Backendâ”‚
             â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
             â”‚         â”‚  â”‚ Link       â”‚ â”‚
             â”‚         â”‚  â”‚ Analysis   â”‚ â”‚
             â”‚         â”‚  â”‚ Service    â”‚ â”‚
             â”‚         â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚
             â”‚         â”‚        â”‚        â”‚
             â”‚         â”‚        â–¼        â”‚
             â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
             â”‚         â”‚  â”‚ Gemini AI  â”‚ â”‚
             â”‚         â”‚  â”‚ Analysis   â”‚ â”‚
             â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
             â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SQLite Database â”‚
    â”‚ (Local Queue)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1-2. ê¸°ìˆ  ìŠ¤íƒ
```yaml
iOS Share Extension:
  Language: Swift 5.9+
  Framework: UIKit
  Min iOS: 14.0+
  Data Sharing: App Groups
  Storage: UserDefaults (Shared)
  Max Memory: 30MB

Flutter App:
  Framework: Flutter 3.16+
  State Management: Riverpod 2.4+
  Packages:
    - receive_sharing_intent: ^1.5.1
    - shared_preferences: ^2.2.2
    - freezed: ^2.4.6
    - freezed_annotation: ^2.4.1
    - json_annotation: ^4.8.1
  Storage: SharedPreferences + SQLite

Backend:
  Runtime: Python 3.11+
  Framework: FastAPI
  AI: Google Gemini API
  Endpoints:
    - POST /api/v1/link-analysis/analyze (ê¸°ì¡´ í™œìš©)

Security:
  Data: App Groups Sandboxing
  Network: HTTPS/TLS 1.3
  Token: Firebase ID Token
```

---

## 2. iOS Share Extension êµ¬í˜„

### 2-1. Xcode í”„ë¡œì íŠ¸ ì„¤ì •

#### Step 1: Share Extension Target ì¶”ê°€
```bash
# Xcodeì—ì„œ
1. File > New > Target
2. iOS > Share Extension ì„ íƒ
3. Product Name: ShareExtension
4. Language: Swift
5. Bundle Identifier: com.hotly.app.ShareExtension
6. Embed In Application: Runner
```

#### Step 2: App Groups ì„¤ì •
```bash
# 1. Apple Developer Console
- Certificates, Identifiers & Profiles
- App Groups ìƒì„±: group.com.hotly.sharequeue

# 2. Main App (Runner) Capabilities
- Signing & Capabilities íƒ­
- + Capability > App Groups
- âœ… group.com.hotly.sharequeue

# 3. Share Extension Capabilities
- Share Extension target ì„ íƒ
- Signing & Capabilities íƒ­
- + Capability > App Groups
- âœ… group.com.hotly.sharequeue
```

### 2-2. Info.plist ì„¤ì •

#### ShareExtension/Info.plist
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>NSExtension</key>
    <dict>
        <key>NSExtensionAttributes</key>
        <dict>
            <key>NSExtensionActivationRule</key>
            <dict>
                <!-- URL ê³µìœ  ì§€ì› -->
                <key>NSExtensionActivationSupportsWebURLWithMaxCount</key>
                <integer>5</integer>

                <!-- ì›¹í˜ì´ì§€ ê³µìœ  ì§€ì› -->
                <key>NSExtensionActivationSupportsWebPageWithMaxCount</key>
                <integer>5</integer>
            </dict>
        </dict>

        <key>NSExtensionMainStoryboard</key>
        <string>MainInterface</string>

        <key>NSExtensionPointIdentifier</key>
        <string>com.apple.share-services</string>
    </dict>
</dict>
</plist>
```

### 2-3. ShareViewController.swift êµ¬í˜„

#### ì „ì²´ ì½”ë“œ
```swift
import UIKit
import Social
import MobileCoreServices

class ShareViewController: SLComposeServiceViewController {

    // App Group ì‹ë³„ì
    private let appGroupId = "group.com.hotly.sharequeue"

    // ì§€ì›í•˜ëŠ” ë„ë©”ì¸
    private let allowedDomains = [
        "instagram.com",
        "blog.naver.com",
        "youtube.com",
        "youtu.be"
    ]

    override func viewDidLoad() {
        super.viewDidLoad()

        // UI ì»¤ìŠ¤í„°ë§ˆì´ì§•
        self.title = "Hotlyì— ì¶”ê°€"
        self.placeholder = "ì´ ì¥ì†Œì— ëŒ€í•œ ë©”ëª¨ (ì„ íƒì‚¬í•­)"

        // ê³µìœ  í•­ëª© ì²˜ë¦¬
        handleSharedContent()
    }

    private func handleSharedContent() {
        guard let extensionItem = extensionContext?.inputItems.first as? NSExtensionItem,
              let itemProviders = extensionItem.attachments else {
            closeWithError("ê³µìœ í•  í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
            return
        }

        // URL ì¶”ì¶œ
        for provider in itemProviders {
            if provider.hasItemConformingToTypeIdentifier(kUTTypeURL as String) {
                provider.loadItem(forTypeIdentifier: kUTTypeURL as String, options: nil) { [weak self] (item, error) in
                    guard let self = self,
                          let url = item as? URL else { return }

                    DispatchQueue.main.async {
                        self.processURL(url)
                    }
                }
                break
            } else if provider.hasItemConformingToTypeIdentifier(kUTTypePropertyList as String) {
                provider.loadItem(forTypeIdentifier: kUTTypePropertyList as String, options: nil) { [weak self] (item, error) in
                    guard let self = self,
                          let dictionary = item as? [String: Any],
                          let results = dictionary[NSExtensionJavaScriptPreprocessingResultsKey] as? [String: Any],
                          let urlString = results["URL"] as? String,
                          let url = URL(string: urlString) else { return }

                    DispatchQueue.main.async {
                        self.processURL(url)
                    }
                }
                break
            }
        }
    }

    private func processURL(_ url: URL) {
        // ë„ë©”ì¸ ê²€ì¦
        guard isAllowedDomain(url) else {
            closeWithError("ì§€ì›í•˜ì§€ ì•ŠëŠ” í”Œë«í¼ì…ë‹ˆë‹¤\n(Instagram, ë„¤ì´ë²„ ë¸”ë¡œê·¸, YouTubeë§Œ ì§€ì›)")
            return
        }

        // íì— ì¶”ê°€
        addToQueue(url: url)
    }

    private func isAllowedDomain(_ url: URL) -> Bool {
        guard let host = url.host?.lowercased() else { return false }
        return allowedDomains.contains { host.contains($0) }
    }

    private func addToQueue(url: URL) {
        guard let userDefaults = UserDefaults(suiteName: appGroupId) else {
            closeWithError("ë°ì´í„° ì €ì¥ ì‹¤íŒ¨")
            return
        }

        // ê¸°ì¡´ í ë¡œë“œ
        var queue = loadQueue(from: userDefaults)

        // ì¤‘ë³µ ì²´í¬
        if queue.contains(where: { $0["url"] as? String == url.absoluteString }) {
            closeWithSuccess("ì´ë¯¸ ì¶”ê°€ëœ ë§í¬ì…ë‹ˆë‹¤")
            return
        }

        // í í¬ê¸° ì œí•œ (ìµœëŒ€ 20ê°œ)
        if queue.count >= 20 {
            closeWithError("íê°€ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤\nì•±ì—ì„œ ë¨¼ì € ë¶„ì„í•´ì£¼ì„¸ìš”")
            return
        }

        // ìƒˆ í•­ëª© ì¶”ê°€
        let newItem: [String: Any] = [
            "id": UUID().uuidString,
            "url": url.absoluteString,
            "title": contentText ?? "",
            "sharedAt": ISO8601DateFormatter().string(from: Date()),
            "status": "pending"
        ]

        queue.append(newItem)

        // ì €ì¥
        userDefaults.set(queue, forKey: "share_queue")
        userDefaults.synchronize()

        // ì„±ê³µ ë©”ì‹œì§€
        closeWithSuccess("\(queue.count)ê°œ ë§í¬ ì¶”ê°€ë¨")
    }

    private func loadQueue(from userDefaults: UserDefaults) -> [[String: Any]] {
        guard let data = userDefaults.array(forKey: "share_queue") as? [[String: Any]] else {
            return []
        }
        return data
    }

    private func closeWithSuccess(_ message: String) {
        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ (ê°„ë‹¨í•œ alert)
        let alert = UIAlertController(title: "âœ… ì™„ë£Œ", message: message, preferredStyle: .alert)
        present(alert, animated: true)

        // 0.5ì´ˆ í›„ ìë™ ë‹«ê¸°
        DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) { [weak self] in
            self?.extensionContext?.completeRequest(returningItems: nil, completionHandler: nil)
        }
    }

    private func closeWithError(_ message: String) {
        let alert = UIAlertController(title: "âš ï¸ ì˜¤ë¥˜", message: message, preferredStyle: .alert)
        alert.addAction(UIAlertAction(title: "í™•ì¸", style: .default) { [weak self] _ in
            self?.extensionContext?.cancelRequest(withError: NSError(domain: "ShareExtension", code: -1))
        })
        present(alert, animated: true)
    }

    override func isContentValid() -> Bool {
        // í•­ìƒ true (URL ê²€ì¦ì€ processURLì—ì„œ)
        return true
    }

    override func didSelectPost() {
        // ì´ë¯¸ handleSharedContentì—ì„œ ì²˜ë¦¬ë¨
        extensionContext?.completeRequest(returningItems: nil, completionHandler: nil)
    }

    override func configurationItems() -> [Any]! {
        // ì¶”ê°€ ì„¤ì • í•­ëª© (í•„ìš”ì‹œ)
        return []
    }
}
```

### 2-4. ë¹Œë“œ ì„¤ì •

#### Podfile ìˆ˜ì •
```ruby
target 'ShareExtension' do
  use_frameworks!

  # Share Extensionì€ ìµœì†Œí•œì˜ ì˜ì¡´ì„±ë§Œ
  # UserDefaultsë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ì¶”ê°€ pod ë¶ˆí•„ìš”
end
```

---

## 3. Flutter App êµ¬í˜„

### 3-1. íŒ¨í‚¤ì§€ ì„¤ì¹˜

#### pubspec.yaml
```yaml
dependencies:
  flutter:
    sdk: flutter

  # State Management
  flutter_riverpod: ^2.4.9

  # Share Intent
  receive_sharing_intent: ^1.5.1

  # Local Storage
  shared_preferences: ^2.2.2

  # Code Generation
  freezed_annotation: ^2.4.1
  json_annotation: ^4.8.1

  # Utilities
  uuid: ^4.3.3

dev_dependencies:
  # Code Generators
  freezed: ^2.4.6
  json_serializable: ^6.7.1
  build_runner: ^2.4.7
```

### 3-2. ë°ì´í„° ëª¨ë¸

#### models/share_queue_item.dart
```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'share_queue_item.freezed.dart';
part 'share_queue_item.g.dart';

enum ShareQueueStatus {
  pending,
  analyzing,
  completed,
  saved,
  failed,
  ignored,
}

@freezed
class ShareQueueItem with _$ShareQueueItem {
  const factory ShareQueueItem({
    required String id,
    required String url,
    String? title,
    required DateTime sharedAt,
    @Default(ShareQueueStatus.pending) ShareQueueStatus status,
    PlaceAnalysisResult? result,
    String? errorMessage,
    @Default(0) int retryCount,
  }) = _ShareQueueItem;

  factory ShareQueueItem.fromJson(Map<String, dynamic> json) =>
      _$ShareQueueItemFromJson(json);
}

@freezed
class PlaceAnalysisResult with _$PlaceAnalysisResult {
  const factory PlaceAnalysisResult({
    required String placeName,
    required String category,
    String? address,
    String? imageUrl,
    @Default(0.0) double confidence,
    Map<String, dynamic>? extractedInfo,
  }) = _PlaceAnalysisResult;

  factory PlaceAnalysisResult.fromJson(Map<String, dynamic> json) =>
      _$PlaceAnalysisResultFromJson(json);
}
```

### 3-3. State Management

#### providers/share_queue_provider.dart
```dart
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:freezed_annotation/freezed_annotation.dart';
import '../models/share_queue_item.dart';
import '../services/share_queue_service.dart';
import '../services/link_analysis_service.dart';

part 'share_queue_provider.freezed.dart';

@freezed
class ShareQueueState with _$ShareQueueState {
  const factory ShareQueueState({
    @Default([]) List<ShareQueueItem> items,
    @Default(false) bool isProcessing,
    @Default(0) int processingIndex,
    String? error,
  }) = _ShareQueueState;
}

class ShareQueueNotifier extends StateNotifier<ShareQueueState> {
  ShareQueueNotifier(this._service, this._analysisService, this._ref)
      : super(const ShareQueueState()) {
    _loadQueue();
  }

  final ShareQueueService _service;
  final LinkAnalysisService _analysisService;
  final Ref _ref;

  // í ë¡œë“œ
  Future<void> _loadQueue() async {
    try {
      final items = await _service.loadQueue();
      state = state.copyWith(items: items);
    } catch (e) {
      state = state.copyWith(error: e.toString());
    }
  }

  // ìƒˆ URL ì¶”ê°€
  Future<void> addUrl(String url, {String? title}) async {
    final newItem = ShareQueueItem(
      id: const Uuid().v4(),
      url: url,
      title: title,
      sharedAt: DateTime.now(),
    );

    state = state.copyWith(
      items: [...state.items, newItem],
    );

    await _service.saveQueue(state.items);
  }

  // ì¼ê´„ ë¶„ì„ ì‹œì‘
  Future<void> processBatch() async {
    if (state.isProcessing) return;

    state = state.copyWith(isProcessing: true);

    final pendingItems = state.items
        .where((item) => item.status == ShareQueueStatus.pending)
        .toList();

    for (var i = 0; i < pendingItems.length; i++) {
      state = state.copyWith(processingIndex: i);

      await _analyzeItem(pendingItems[i]);

      // í’ˆì§ˆ ìš°ì„ : ê° ë¶„ì„ ëŒ€ê¸°
      await Future.delayed(const Duration(milliseconds: 500));
    }

    state = state.copyWith(
      isProcessing: false,
      processingIndex: 0,
    );
  }

  Future<void> _analyzeItem(ShareQueueItem item) async {
    // ìƒíƒœ: analyzing
    _updateItemStatus(item.id, ShareQueueStatus.analyzing);

    try {
      // API í˜¸ì¶œ
      final result = await _analysisService.analyzeLink(item.url);

      // ì„±ê³µ: completed
      _updateItemWithResult(item.id, result);
    } catch (e) {
      // ì‹¤íŒ¨: failed
      _updateItemError(item.id, e.toString());
    }

    await _service.saveQueue(state.items);
  }

  void _updateItemStatus(String id, ShareQueueStatus status) {
    state = state.copyWith(
      items: state.items
          .map((item) => item.id == id ? item.copyWith(status: status) : item)
          .toList(),
    );
  }

  void _updateItemWithResult(String id, PlaceAnalysisResult result) {
    state = state.copyWith(
      items: state.items
          .map((item) => item.id == id
              ? item.copyWith(
                  status: ShareQueueStatus.completed,
                  result: result,
                  errorMessage: null,
                )
              : item)
          .toList(),
    );
  }

  void _updateItemError(String id, String error) {
    state = state.copyWith(
      items: state.items
          .map((item) => item.id == id
              ? item.copyWith(
                  status: ShareQueueStatus.failed,
                  errorMessage: error,
                  retryCount: item.retryCount + 1,
                )
              : item)
          .toList(),
    );
  }

  // ì¬ì‹œë„
  Future<void> retryFailed() async {
    final failedItems = state.items
        .where((item) =>
            item.status == ShareQueueStatus.failed && item.retryCount < 3)
        .toList();

    for (final item in failedItems) {
      await _analyzeItem(item);
    }
  }

  // ì €ì¥
  Future<void> saveItem(String id) async {
    _updateItemStatus(id, ShareQueueStatus.saved);
    await _service.saveQueue(state.items);
  }

  // ë¬´ì‹œ
  Future<void> ignoreItem(String id) async {
    _updateItemStatus(id, ShareQueueStatus.ignored);
    await _service.saveQueue(state.items);
  }

  // ì‚­ì œ
  Future<void> removeItem(String id) async {
    state = state.copyWith(
      items: state.items.where((item) => item.id != id).toList(),
    );
    await _service.saveQueue(state.items);
  }

  // ì „ì²´ ì‚­ì œ
  Future<void> clearQueue() async {
    state = const ShareQueueState();
    await _service.clearQueue();
  }
}

final shareQueueProvider =
    StateNotifierProvider<ShareQueueNotifier, ShareQueueState>((ref) {
  final service = ref.watch(shareQueueServiceProvider);
  final analysisService = ref.watch(linkAnalysisServiceProvider);
  return ShareQueueNotifier(service, analysisService, ref);
});
```

### 3-4. Local Storage Service

#### services/share_queue_service.dart
```dart
import 'dart:convert';
import 'package:shared_preferences/shared_preferences.dart';
import '../models/share_queue_item.dart';

class ShareQueueService {
  static const String _queueKey = 'share_queue';
  static const int _maxQueueSize = 20;
  static const Duration _itemTTL = Duration(days: 7);

  // í ë¡œë“œ
  Future<List<ShareQueueItem>> loadQueue() async {
    final prefs = await SharedPreferences.getInstance();
    final jsonStr = prefs.getString(_queueKey);

    if (jsonStr == null || jsonStr.isEmpty) {
      return [];
    }

    try {
      final List<dynamic> jsonList = jsonDecode(jsonStr);
      final items = jsonList
          .map((json) => ShareQueueItem.fromJson(json as Map<String, dynamic>))
          .toList();

      // ì˜¤ë˜ëœ í•­ëª© ìë™ ì œê±°
      final now = DateTime.now();
      final validItems = items
          .where((item) => now.difference(item.sharedAt) < _itemTTL)
          .toList();

      // ì •ë¦¬ê°€ í•„ìš”í•˜ë©´ ì €ì¥
      if (validItems.length != items.length) {
        await saveQueue(validItems);
      }

      return validItems;
    } catch (e) {
      // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë¹ˆ í ë°˜í™˜
      return [];
    }
  }

  // í ì €ì¥
  Future<void> saveQueue(List<ShareQueueItem> items) async {
    final prefs = await SharedPreferences.getInstance();

    // í¬ê¸° ì œí•œ
    final limitedItems = items.take(_maxQueueSize).toList();

    final jsonList = limitedItems.map((item) => item.toJson()).toList();
    final jsonStr = jsonEncode(jsonList);

    await prefs.setString(_queueKey, jsonStr);
  }

  // í ì‚­ì œ
  Future<void> clearQueue() async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.remove(_queueKey);
  }

  // App Groupsì—ì„œ ë¡œë“œ (iOS)
  Future<List<ShareQueueItem>> loadFromAppGroups() async {
    // iOS Share Extensionì—ì„œ ì¶”ê°€í•œ í•­ëª© ê°€ì ¸ì˜¤ê¸°
    // UserDefaults(suiteName:)ìœ¼ë¡œ ì ‘ê·¼
    // Flutterì—ì„œëŠ” shared_preferencesê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬
    return loadQueue();
  }
}

final shareQueueServiceProvider = Provider<ShareQueueService>((ref) {
  return ShareQueueService();
});
```

### 3-5. Share Intent ìˆ˜ì‹ 

#### main.dart
```dart
import 'package:receive_sharing_intent/receive_sharing_intent.dart';

class MyApp extends ConsumerStatefulWidget {
  @override
  ConsumerState<MyApp> createState() => _MyAppState();
}

class _MyAppState extends ConsumerState<MyApp> {
  late StreamSubscription _intentDataStreamSubscription;

  @override
  void initState() {
    super.initState();

    // ì•± ì‹¤í–‰ ì¤‘ ê³µìœ  ë°›ê¸°
    _intentDataStreamSubscription =
        ReceiveSharingIntent.getTextStream().listen((String value) {
      _handleSharedUrl(value);
    }, onError: (err) {
      print("Error receiving share: $err");
    });

    // ì•±ì´ ì¢…ë£Œ ìƒíƒœì—ì„œ ê³µìœ ë¡œ ì‹¤í–‰
    ReceiveSharingIntent.getInitialText().then((String? value) {
      if (value != null) {
        _handleSharedUrl(value);
      }
    });
  }

  void _handleSharedUrl(String url) {
    // ShareQueueProviderì— ì¶”ê°€
    ref.read(shareQueueProvider.notifier).addUrl(url);

    // í™ˆ í™”ë©´ìœ¼ë¡œ ì´ë™
    context.go('/home');
  }

  @override
  void dispose() {
    _intentDataStreamSubscription.cancel();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return MaterialApp.router(
      routerConfig: router,
    );
  }
}
```

---

## 4. UI êµ¬í˜„

### 4-1. í™ˆ í™”ë©´ ë°°ì§€

#### widgets/share_queue_badge.dart
```dart
class ShareQueueBadge extends ConsumerWidget {
  const ShareQueueBadge({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final queueState = ref.watch(shareQueueProvider);
    final pendingCount = queueState.items
        .where((item) => item.status == ShareQueueStatus.pending)
        .length;

    if (pendingCount == 0) return const SizedBox.shrink();

    return Container(
      margin: const EdgeInsets.all(16),
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: AppColors.primary,
        borderRadius: BorderRadius.circular(12),
        boxShadow: [
          BoxShadow(
            color: AppColors.primary.withOpacity(0.3),
            blurRadius: 8,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Row(
        children: [
          const Icon(Icons.link, color: Colors.white, size: 24),
          const SizedBox(width: 12),
          Expanded(
            child: Text(
              '$pendingCountê°œ ë§í¬ ë¶„ì„ ëŒ€ê¸° ì¤‘',
              style: AppTextStyles.subtitle1.copyWith(color: Colors.white),
            ),
          ),
          ElevatedButton(
            onPressed: () => _showProcessingSheet(context, ref),
            style: ElevatedButton.styleFrom(
              backgroundColor: Colors.white,
              foregroundColor: AppColors.primary,
            ),
            child: const Text('ë¶„ì„ ì‹œì‘'),
          ),
        ],
      ),
    );
  }

  void _showProcessingSheet(BuildContext context, WidgetRef ref) {
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      builder: (context) => const BatchProcessingSheet(),
    );

    // ë¶„ì„ ì‹œì‘
    ref.read(shareQueueProvider.notifier).processBatch();
  }
}
```

### 4-2. ë¶„ì„ ì§„í–‰ ë°”í…€ ì‹œíŠ¸

#### widgets/batch_processing_sheet.dart
```dart
class BatchProcessingSheet extends ConsumerWidget {
  const BatchProcessingSheet({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final state = ref.watch(shareQueueProvider);
    final totalCount = state.items
        .where((item) => item.status != ShareQueueStatus.saved &&
            item.status != ShareQueueStatus.ignored)
        .length;

    final progress = totalCount == 0 ? 0.0 : state.processingIndex / totalCount;

    return Container(
      height: MediaQuery.of(context).size.height * 0.7,
      padding: const EdgeInsets.all(24),
      child: Column(
        children: [
          // ì œëª©
          Text(
            'ğŸ“¦ ë§í¬ ë¶„ì„ ì¤‘ (${state.processingIndex}/$totalCount)',
            style: AppTextStyles.h3,
          ),
          const SizedBox(height: 16),

          // ì§„í–‰ë¥ 
          LinearProgressIndicator(
            value: progress,
            minHeight: 8,
            borderRadius: BorderRadius.circular(4),
          ),
          const SizedBox(height: 8),
          Text(
            '${(progress * 100).toInt()}%',
            style: AppTextStyles.body2,
          ),
          const SizedBox(height: 24),

          // í•­ëª© ëª©ë¡
          Expanded(
            child: ListView.builder(
              itemCount: state.items.length,
              itemBuilder: (context, index) {
                final item = state.items[index];
                return ShareQueueItemTile(item: item);
              },
            ),
          ),

          // ë°±ê·¸ë¼ìš´ë“œ ë²„íŠ¼
          if (state.isProcessing)
            ElevatedButton(
              onPressed: () => Navigator.pop(context),
              child: const Text('ë°±ê·¸ë¼ìš´ë“œë¡œ'),
            ),
        ],
      ),
    );
  }
}

class ShareQueueItemTile extends StatelessWidget {
  final ShareQueueItem item;

  const ShareQueueItemTile({super.key, required this.item});

  @override
  Widget build(BuildContext context) {
    return ListTile(
      leading: _buildStatusIcon(),
      title: Text(
        item.result?.placeName ?? item.title ?? item.url,
        maxLines: 1,
        overflow: TextOverflow.ellipsis,
      ),
      subtitle: _buildSubtitle(),
      trailing: item.status == ShareQueueStatus.completed
          ? Text(
              '${(item.result!.confidence * 100).toInt()}%',
              style: AppTextStyles.caption.copyWith(
                color: _getConfidenceColor(item.result!.confidence),
                fontWeight: FontWeight.bold,
              ),
            )
          : null,
    );
  }

  Widget _buildStatusIcon() {
    switch (item.status) {
      case ShareQueueStatus.pending:
        return const Icon(Icons.schedule, color: Colors.grey);
      case ShareQueueStatus.analyzing:
        return const SizedBox(
          width: 24,
          height: 24,
          child: CircularProgressIndicator(strokeWidth: 2),
        );
      case ShareQueueStatus.completed:
        return const Icon(Icons.check_circle, color: Colors.green);
      case ShareQueueStatus.failed:
        return const Icon(Icons.error, color: Colors.red);
      default:
        return const SizedBox.shrink();
    }
  }

  Widget? _buildSubtitle() {
    switch (item.status) {
      case ShareQueueStatus.pending:
        return const Text('ëŒ€ê¸° ì¤‘');
      case ShareQueueStatus.analyzing:
        return const Text('ë¶„ì„ ì¤‘...');
      case ShareQueueStatus.completed:
        return Text(item.result?.category ?? '');
      case ShareQueueStatus.failed:
        return Text(
          item.errorMessage ?? 'ë¶„ì„ ì‹¤íŒ¨',
          style: const TextStyle(color: Colors.red),
        );
      default:
        return null;
    }
  }

  Color _getConfidenceColor(double confidence) {
    if (confidence >= 0.9) return Colors.green;
    if (confidence >= 0.7) return Colors.orange;
    return Colors.red;
  }
}
```

---

## 5. ì„±ëŠ¥ ìµœì í™”

### 5-1. ë©”ëª¨ë¦¬ ê´€ë¦¬
```dart
// í í¬ê¸° ì œí•œ
static const int _maxQueueSize = 20;

// ì˜¤ë˜ëœ í•­ëª© ìë™ ì •ë¦¬
static const Duration _itemTTL = Duration(days: 7);

// ì´ë¯¸ì§€ ìºì‹± ì œí•œ
CachedNetworkImage(
  imageUrl: imageUrl,
  memCacheWidth: 400,
  memCacheHeight: 400,
  maxWidthDiskCache: 800,
  maxHeightDiskCache: 800,
)
```

### 5-2. ë„¤íŠ¸ì›Œí¬ ìµœì í™”
```dart
// ìˆœì°¨ ì²˜ë¦¬ë¡œ ì„œë²„ ë¶€í•˜ ë¶„ì‚°
for (final item in items) {
  await _analyzeItem(item);
  await Future.delayed(const Duration(milliseconds: 500));
}

// íƒ€ì„ì•„ì›ƒ ì„¤ì •
final dio = Dio(
  BaseOptions(
    connectTimeout: const Duration(seconds: 30),
    receiveTimeout: const Duration(seconds: 30),
  ),
);
```

### 5-3. ë°°í„°ë¦¬ ìµœì í™”
```dart
import 'package:battery_plus/battery_plus.dart';

class BatteryAwareProcessor {
  final Battery _battery = Battery();

  Future<bool> shouldProcess() async {
    final level = await _battery.batteryLevel;
    final state = await _battery.batteryState;

    // ì¶©ì „ ì¤‘ì´ê±°ë‚˜ ë°°í„°ë¦¬ 20% ì´ìƒ
    return state == BatteryState.charging || level > 20;
  }
}
```

---

## 6. ì—ëŸ¬ ì²˜ë¦¬

### 6-1. ì¬ì‹œë„ ë¡œì§
```dart
Future<void> _analyzeWithRetry(ShareQueueItem item) async {
  const maxRetries = 3;
  const retryDelay = Duration(seconds: 2);

  for (var i = 0; i < maxRetries; i++) {
    try {
      final result = await _analysisService.analyzeLink(item.url);
      _updateItemWithResult(item.id, result);
      return;
    } catch (e) {
      if (i == maxRetries - 1) {
        _updateItemError(item.id, e.toString());
      } else {
        await Future.delayed(retryDelay * (i + 1));
      }
    }
  }
}
```

### 6-2. ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬
```dart
class NetworkErrorHandler {
  static Future<T> handleNetworkCall<T>(
    Future<T> Function() call,
  ) async {
    try {
      return await call();
    } on DioException catch (e) {
      if (e.type == DioExceptionType.connectionTimeout) {
        throw 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹œê°„ ì´ˆê³¼';
      } else if (e.type == DioExceptionType.receiveTimeout) {
        throw 'ì„œë²„ ì‘ë‹µ ì‹œê°„ ì´ˆê³¼';
      } else if (e.response?.statusCode == 429) {
        throw 'ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”';
      } else {
        throw 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${e.message}';
      }
    }
  }
}
```

---

## 7. í…ŒìŠ¤íŠ¸

### 7-1. Unit Tests
```dart
// test/share_queue_service_test.dart
void main() {
  group('ShareQueueService', () {
    late ShareQueueService service;

    setUp(() {
      service = ShareQueueService();
    });

    test('should save and load queue', () async {
      final items = [
        ShareQueueItem(
          id: '1',
          url: 'https://instagram.com/p/xxx',
          sharedAt: DateTime.now(),
        ),
      ];

      await service.saveQueue(items);
      final loaded = await service.loadQueue();

      expect(loaded.length, 1);
      expect(loaded.first.url, 'https://instagram.com/p/xxx');
    });

    test('should limit queue size to 20', () async {
      final items = List.generate(
        25,
        (i) => ShareQueueItem(
          id: '$i',
          url: 'https://example.com/$i',
          sharedAt: DateTime.now(),
        ),
      );

      await service.saveQueue(items);
      final loaded = await service.loadQueue();

      expect(loaded.length, 20);
    });
  });
}
```

### 7-2. Widget Tests
```dart
// test/widgets/share_queue_badge_test.dart
void main() {
  testWidgets('should show pending count', (tester) async {
    final container = ProviderContainer(
      overrides: [
        shareQueueProvider.overrideWith((ref) {
          return ShareQueueNotifier(...);
        }),
      ],
    );

    await tester.pumpWidget(
      UncontrolledProviderScope(
        container: container,
        child: MaterialApp(
          home: Scaffold(
            body: ShareQueueBadge(),
          ),
        ),
      ),
    );

    expect(find.text('3ê°œ ë§í¬ ë¶„ì„ ëŒ€ê¸° ì¤‘'), findsOneWidget);
  });
}
```

### 7-3. Integration Tests
```dart
// integration_test/share_flow_test.dart
void main() {
  testWidgets('complete share flow', (tester) async {
    await tester.pumpWidget(MyApp());

    // 1. ê³µìœ  URL ì¶”ê°€
    // (Share Extension í…ŒìŠ¤íŠ¸ëŠ” ìˆ˜ë™)

    // 2. ë°°ì§€ í™•ì¸
    expect(find.byType(ShareQueueBadge), findsOneWidget);

    // 3. ë¶„ì„ ì‹œì‘
    await tester.tap(find.text('ë¶„ì„ ì‹œì‘'));
    await tester.pumpAndSettle();

    // 4. ì§„í–‰ í™•ì¸
    expect(find.byType(BatchProcessingSheet), findsOneWidget);

    // 5. ì™„ë£Œ ëŒ€ê¸°
    await tester.pump(Duration(seconds: 60));

    // 6. ê²°ê³¼ í™•ì¸
    expect(find.text('ë¶„ì„ ì™„ë£Œ'), findsOneWidget);
  });
}
```

---

## 8. ë°°í¬

### 8-1. iOS ë¹Œë“œ ì„¤ì •
```bash
# 1. Bundle ID í™•ì¸
Main App: com.hotly.app
Share Extension: com.hotly.app.ShareExtension

# 2. App Groups í™•ì¸
group.com.hotly.sharequeue

# 3. í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼
- Main App: Distribution Profile
- Share Extension: Distribution Profile (ë™ì¼ Team ID)

# 4. ë¹Œë“œ
flutter build ios --release
```

### 8-2. ë²„ì „ ê´€ë¦¬
```yaml
# pubspec.yaml
version: 1.1.0+11

# iOS/Runner/Info.plist
CFBundleShortVersionString: 1.1.0
CFBundleVersion: 11

# iOS/ShareExtension/Info.plist
CFBundleShortVersionString: 1.1.0
CFBundleVersion: 11
```

---

## 9. ëª¨ë‹ˆí„°ë§

### 9-1. Analytics
```dart
class ShareQueueAnalytics {
  static Future<void> logShareReceived(String platform) async {
    await FirebaseAnalytics.instance.logEvent(
      name: 'share_received',
      parameters: {'platform': platform},
    );
  }

  static Future<void> logBatchProcessingStarted(int itemCount) async {
    await FirebaseAnalytics.instance.logEvent(
      name: 'batch_processing_started',
      parameters: {'item_count': itemCount},
    );
  }

  static Future<void> logAnalysisCompleted({
    required String itemId,
    required double confidence,
    required Duration duration,
  }) async {
    await FirebaseAnalytics.instance.logEvent(
      name: 'analysis_completed',
      parameters: {
        'item_id': itemId,
        'confidence': confidence,
        'duration_ms': duration.inMilliseconds,
      },
    );
  }
}
```

### 9-2. Error Tracking
```dart
class ShareQueueErrorTracking {
  static Future<void> logError(
    String operation,
    dynamic error,
    StackTrace? stack,
  ) async {
    await FirebaseCrashlytics.instance.recordError(
      error,
      stack,
      reason: 'ShareQueue: $operation',
    );
  }
}
```

---

## 10. ë³´ì•ˆ

### 10-1. URL ê²€ì¦
```dart
class URLValidator {
  static final _allowedDomains = [
    'instagram.com',
    'blog.naver.com',
    'youtube.com',
    'youtu.be',
  ];

  static bool isAllowed(String url) {
    try {
      final uri = Uri.parse(url);
      final host = uri.host.toLowerCase();
      return _allowedDomains.any((domain) => host.contains(domain));
    } catch (e) {
      return false;
    }
  }

  static bool isSafe(String url) {
    // XSS, SSRF ë°©ì§€
    final uri = Uri.parse(url);
    return uri.scheme == 'https' || uri.scheme == 'http';
  }
}
```

### 10-2. ë°ì´í„° ì•”í˜¸í™”
```dart
// Sensitive dataëŠ” flutter_secure_storage ì‚¬ìš©
import 'package:flutter_secure_storage/flutter_secure_storage.dart';

class SecureQueueStorage {
  final FlutterSecureStorage _storage = FlutterSecureStorage();

  Future<void> saveSecureQueue(List<ShareQueueItem> items) async {
    final jsonStr = jsonEncode(items.map((e) => e.toJson()).toList());
    await _storage.write(key: 'secure_queue', value: jsonStr);
  }
}
```

---

**ë²„ì „:** v1.0
**ì‘ì„±ì¼:** 2025-11-26
**ì‘ì„±ì:** Claude Code
**ìƒíƒœ:** êµ¬í˜„ ì¤€ë¹„ ì™„ë£Œ
